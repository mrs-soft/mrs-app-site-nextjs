(()=>{"use strict";class t{constructor(t){this.widgetBox=void 0,this.redirectUrl="",this.productId=null,this.cardList=null,this.input=null,this.plus=null,this.minus=null,this.period=null,this.countName=null,this.monthPeriod=null,this.yearPeriod=null,this.widgetCreate=()=>{var t,i,s,e,n,o;const a=this.widgetBox,r=this.plans||[];let d=0,c=1,u=!1;r.forEach((t=>{t.maxLicenseCount>c&&(c=t.maxLicenseCount),t.discount>d&&(d=t.discount),t.maxLicenseCount===t.minLicenseCount||u||(u=!0)}));const l=`\n      <div class="saas-shop-container">\n        <div class="saas-shop-title">Выберите подписку</div>\n        <div class="saas-shop-common-form">\n         ${u?`<div class="saas-shop-count-container">\n            <div class="saas-shop-form-minus"></div>\n            <div class="body2">\n              <input class="saas-shop-form-input" type="number" name="count" min="1"  max="${c}" value="1" \n                      onkeydown="this.style.width = ((this.value.length+1 ) * 9) + 'px';" onkeyup="if(this.value<0) value=1;">\n              <span class="saas-shop-count-name">пользователь</span>\n            </div>\n            <div class="saas-shop-form-plus"></div>\n          </div>`:""}\n          <label class="saas-shop-period-container">\n            <input type="checkbox" class="saas-shop-period-input">\n            <button class="saas-shop-period-month">\n             Месячная\n            </button>\n            <button class="saas-shop-period-year">\n             Годовая\n            </button>  \n            ${d?`<div class="saas-shop-period-sale" > - ${d}% </div>`:""}\n          </label>\n        </div>\n        <div class="saas-shop-card-container"> \n          ${(()=>{let t="";return r.forEach((i=>{var s,e;const n=i.id===(null===(s=this.config)||void 0===s?void 0:s.hightlight)?"contained":"outlined",o=i.id===(null===(e=this.config)||void 0===e?void 0:e.subscriptionId)?"disabled":"";t+=`\n          <div class="saas-shop-card" data-tariffid="${i.id}" >\n            <div class="saas-shop-card-name subtitle2">${i.name}</div>\n            <h5 class="saas-shop-price-value">\n              ${i.price.toLocaleString()} ₽\n               <span> ₽ </span>\n            </h5>\n            <div class="saas-shop-price-text body2">за пользователя в </div>\n            <div class="saas-shop-description body2">${i.description}</div>\n              <button class="saas-shop-card-button-container ${n} large" disabled=${o}></button>\n          </div>    \n          `})),t})()}\n        </div>\n      </div>`;a.innerHTML+=l,this.cardList=document.querySelectorAll(".saas-shop-card"),this.input=document.querySelector(".saas-shop-form-input"),this.plus=document.querySelector(".saas-shop-form-plus"),this.minus=document.querySelector(".saas-shop-form-minus"),this.period=document.querySelector(".saas-shop-period-input"),this.countName=document.querySelector(".saas-shop-count-name"),this.monthPeriod=document.querySelector(".saas-shop-period-month"),this.yearPeriod=document.querySelector(".saas-shop-period-year"),this.checkTariff(r),null===(t=this.input)||void 0===t||t.addEventListener("change",(()=>{this.checkTariff(r)})),null===(i=this.plus)||void 0===i||i.addEventListener("click",(()=>{this.calcPlus(this.plus,c),this.checkTariff(r)})),null===(s=this.minus)||void 0===s||s.addEventListener("click",(()=>{this.calcMinus(this.minus),this.checkTariff(r)})),null===(e=this.monthPeriod)||void 0===e||e.addEventListener("click",(t=>{this.setPeriod(t.target,!1)})),null===(n=this.yearPeriod)||void 0===n||n.addEventListener("click",(t=>{this.setPeriod(t.target,!0)})),null===(o=this.period)||void 0===o||o.parentNode.addEventListener("click",(()=>{this.checkTariff(r)}))},this.checkLicensesCount=(t,i,s)=>{const e=t.querySelector(".saas-shop-card-button-container");return i>s.maxLicenseCount&&s.minLicenseCount!==s.maxLicenseCount?(e.setAttribute("disabled","disabled"),`До ${s.maxLicenseCount} ${this.conditionUserText(s.maxLicenseCount)}`):i<s.minLicenseCount&&s.maxLicenseCount!==s.minLicenseCount?(e.setAttribute("disabled","disabled"),`От ${s.minLicenseCount} ${this.conditionUserText(s.minLicenseCount)}`):void e.removeAttribute("disabled")},this.setButton=(t,i,s)=>{var e,n,o,a;const r=t.querySelector(".saas-shop-card-button-container");let d="";const c=(null===(e=this.config)||void 0===e?void 0:e.subscriptionId)!==i.id,u=i.maxLicenseCount!==i.minLicenseCount,l=i.discount?(null==i?void 0:i.price)*Number(null===(n=this.input)||void 0===n?void 0:n.value)*12*((100-i.discount)/100):(null==i?void 0:i.price)*Number(null===(o=this.input)||void 0===o?void 0:o.value)*12,h=(this.period.checked?l:(null==i?void 0:i.price)*Number(null===(a=this.input)||void 0===a?void 0:a.value)).toLocaleString();d=(null==i?void 0:i.price)&&c&&!s&&this.input&&u?`Купить за ${h} ₽`:!u&&c?`Выбрать ${i.name}`:s||"Текущий тариф";const p=this.createHref(i);c||r.setAttribute("disabled","disabled"),r.innerHTML=`\n      <p class="saas-shop-card-button-href">\n          ${d}\n      </p>\n      `,r.onclick=()=>{window.open(p,"_blank")}},this.checkTariff=t=>{var i,s,e,n;null===(i=this.input)||void 0===i||(i.value=Number(this.input.value)>99999?99999:Number(null===(s=this.input)||void 0===s?void 0:s.value)),this.input&&(this.input.style.width=9*this.input.value.length+"px"),this.countName&&(this.countName.textContent=this.userText(Number(null===(e=this.input)||void 0===e?void 0:e.value)));for(const i of this.cardList){const s=t.find((t=>t.id.toString()===i.dataset.tariffid)),e=this.checkLicensesCount(i,Number(null===(n=this.input)||void 0===n?void 0:n.value),s);this.setButton(i,s,e);const o=i.querySelector(".saas-shop-price-text"),a=i.querySelector(".saas-shop-price-value"),r=this.period.checked?"за пользователя в год":"за пользователя в месяц",d=this.period.checked&&s.discount?(12*s.price*((100-s.discount)/100)).toLocaleString():(12*s.price).toLocaleString();o.textContent=s.maxLicenseCount===s.minLicenseCount?`до ${s.maxLicenseCount} пользователей`:r,a.textContent=this.period.checked?`${d} ₽`:`${s.price.toLocaleString()} ₽`}},this.createHref=t=>{var i,s;const e=this.period.checked?"&annually=true":"",n=(null===(i=this.input)||void 0===i?void 0:i.value)&&t.maxLicenseCount!==t.minLicenseCount?null===(s=this.input)||void 0===s?void 0:s.value:t.maxLicenseCount;return this.redirectUrl+`/checkout?productId=${this.productId}&tariffId=${t.id}${e}&licensesCount=${n}`},this.calcPlus=(t,i)=>{const s=null==t?void 0:t.parentNode.querySelector(".saas-shop-form-input"),e=parseInt(s.value)+1;i>=e&&(s.value=e)},this.calcMinus=t=>{let i=null==t?void 0:t.parentNode.querySelector(".saas-shop-form-input"),s=parseInt(i.value)-1;1<=s&&(i.value=s)},this.setPeriod=(t,i)=>{(null==t?void 0:t.parentNode.querySelector(".saas-shop-period-input")).checked=i},this.userText=t=>{const i=+t.toString().slice(-1),s=+t.toString().slice(-2,-1);return 1===i&&1!==s?"пользователь":i>1&&i<5&&1!==s?"пользователя":"пользователей"},this.conditionUserText=t=>"1"===t.toString().slice(-1)?"пользователя":"пользователей",this.widgetBox=t.widgetBox,this.redirectUrl=t.redirectUrl,this.productId=t.productId,this.plans=t.plans,this.config=t.config}}var i;const s="saas-shop.dev.mrsapp.ru"===location.host?"https://saas-shop-frontend.dev.mrsapp.ru":"http://localhost:3000",e=(null===(i=window.WidgetConfig)||void 0===i?void 0:i.productId)?window.WidgetConfig.productId:"93c56a4c-3324-454d-9dff-094335f66f40";var n=new class{constructor(t){this.idContainer="",this.api="",this.redirectUrl="",this.productId=null,this.idContainer=t.idContainer,this.api=t.api,this.redirectUrl=t.redirectUrl,this.productId=t.productId}init(i){fetch(this.api+"/products/"+this.productId+"/plans").then((function(t){return 200!==t.status?Promise.reject(new Error(t.statusText)):Promise.resolve(t)})).then((function(t){return t.json()})).then((s=>{document.querySelector(this.idContainer)?new t({widgetBox:document.querySelector(this.idContainer),redirectUrl:this.redirectUrl,productId:this.productId,plans:s,config:i}).widgetCreate():alert("Container with id "+this.idContainer+" not found!")})).catch((t=>{console.log(t)}))}}({idContainer:".saas_shop_tariffs",api:"https://saas-shop-api.dev.mrsapp.ru",redirectUrl:s,productId:e});window.WidgetConfig?n.init(window.WidgetConfig):n.init()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LENBQzlCRyxVQUFXcUMsU0FBU0UsY0FBYzFCLEtBQUttRixhQUN2QzlGLFlBQWFXLEtBQUtYLFlBQ2xCQyxVQUFXVSxLQUFLVixVQUNoQlksTUFBTzhGLEVBQ1BsRixXQUVRZixlQUVWa0csTUFBTSxxQkFBdUJqRyxLQUFLbUYsWUFBYyxjQUNsRCxJQUVEZSxPQUFPQyxJQUNOQyxRQUFRQyxJQUFJRixFQUFNLEdBRXhCLEdEN0IwQyxDQUMxQ2hCLFlBVGtCLHFCQVVsQkMsSUFiVSxzQ0FjVi9GLGNBQ0FDLFVBQVcwRixJQUdUekIsT0FBTzBCLGFBQ1RDLEVBQVVHLEtBQUs5QixPQUFPMEIsY0FDakJDLEVBQVVHLE0iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYWFzLXNob3Atc2l0ZS8uL3NyYy9wcmVzZW50ZXIvd2lkZ2V0Qm94L1dpZGdldEJveC50cyIsIndlYnBhY2s6Ly9zYWFzLXNob3Atc2l0ZS8uL3NyYy9pbmRleC50cyIsIndlYnBhY2s6Ly9zYWFzLXNob3Atc2l0ZS8uL3NyYy9wcmVzZW50ZXIvV2lkZ2V0U2Fhc1Nob3BQcmVzZW50ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSUNvbmZpZyB9IGZyb20gJy4uL0lXaWRnZXRTYWFzU2hvcCdcbmltcG9ydCB7IElQbGFuLCBJV2lkZ2V0Qm94LCBJV2lkZ2V0Qm94UGFyYW1zIH0gZnJvbSAnLi9JV2lkZ2V0Qm94J1xuXG5leHBvcnQgY2xhc3MgV2lkZ2V0Qm94IGltcGxlbWVudHMgSVdpZGdldEJveCB7XG4gIHdpZGdldEJveDogSFRNTERpdkVsZW1lbnQgfCB1bmRlZmluZWQgPSB1bmRlZmluZWRcbiAgcmVkaXJlY3RVcmw6IHN0cmluZyA9ICcnXG4gIHByb2R1Y3RJZDogc3RyaW5nIHwgbnVsbCA9IG51bGxcbiAgcGxhbnM6IElQbGFuW11cbiAgY29uZmlnOiBJQ29uZmlnXG5cbiAgcHJpdmF0ZSBjYXJkTGlzdDogTm9kZUxpc3RPZjxIVE1MRGl2RWxlbWVudD4gfCBudWxsID0gbnVsbFxuICBwcml2YXRlIGlucHV0OiBIVE1MSW5wdXRFbGVtZW50IHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBwbHVzOiBIVE1MRGl2RWxlbWVudCB8IG51bGwgPSBudWxsXG4gIHByaXZhdGUgbWludXM6IEhUTUxEaXZFbGVtZW50IHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBwZXJpb2Q6IEhUTUxJbnB1dEVsZW1lbnQgfCBudWxsID0gbnVsbFxuICBwcml2YXRlIGNvdW50TmFtZTogSFRNTFNwYW5FbGVtZW50IHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBtb250aFBlcmlvZDogSFRNTEJ1dHRvbkVsZW1lbnQgfCBudWxsID0gbnVsbFxuICBwcml2YXRlIHllYXJQZXJpb2Q6IEhUTUxCdXR0b25FbGVtZW50IHwgbnVsbCA9IG51bGxcblxuICBjb25zdHJ1Y3RvcihwYXJhbXM6IElXaWRnZXRCb3hQYXJhbXMpIHtcbiAgICB0aGlzLndpZGdldEJveCA9IHBhcmFtcy53aWRnZXRCb3hcbiAgICB0aGlzLnJlZGlyZWN0VXJsID0gcGFyYW1zLnJlZGlyZWN0VXJsXG4gICAgdGhpcy5wcm9kdWN0SWQgPSBwYXJhbXMucHJvZHVjdElkXG4gICAgdGhpcy5wbGFucyA9IHBhcmFtcy5wbGFuc1xuICAgIHRoaXMuY29uZmlnID0gcGFyYW1zLmNvbmZpZ1xuICB9XG5cbiAgd2lkZ2V0Q3JlYXRlID0gKCk6IHZvaWQgPT4ge1xuICAgIGNvbnN0IHdpZGdldEJveCA9IHRoaXMud2lkZ2V0Qm94XG4gICAgY29uc3QgdGFyaWZmTGlzdDogSVBsYW5bXSA9IHRoaXMucGxhbnMgfHwgW11cbiAgICBsZXQgZGlzY291bnQ6IG51bWJlciA9IDBcbiAgICBsZXQgbWF4aW11bVVzZXJzOiBudW1iZXIgPSAxXG4gICAgbGV0IGlzQ291bnRDb250YWluZXIgPSBmYWxzZVxuXG4gICAgdGFyaWZmTGlzdC5mb3JFYWNoKChlbCkgPT4ge1xuICAgICAgaWYgKGVsLm1heExpY2Vuc2VDb3VudCA+IG1heGltdW1Vc2Vycykge1xuICAgICAgICBtYXhpbXVtVXNlcnMgPSBlbC5tYXhMaWNlbnNlQ291bnRcbiAgICAgIH1cblxuICAgICAgaWYgKGVsLmRpc2NvdW50ID4gZGlzY291bnQpIHtcbiAgICAgICAgZGlzY291bnQgPSBlbC5kaXNjb3VudFxuICAgICAgfVxuXG4gICAgICBpZiAoZWwubWF4TGljZW5zZUNvdW50ICE9PSBlbC5taW5MaWNlbnNlQ291bnQgJiYgIWlzQ291bnRDb250YWluZXIpIHtcbiAgICAgICAgaXNDb3VudENvbnRhaW5lciA9IHRydWVcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgY29uc3Qgb3V0cHV0Q2FyZExpc3QgPSAoKSA9PiB7XG4gICAgICBsZXQgdGVtcG9yYXJ5Q2FyZCA9IGBgXG4gICAgICB0YXJpZmZMaXN0LmZvckVhY2goKGVsKSA9PiB7XG4gICAgICAgIGNvbnN0IHN0eWxlRm9yQnRuID0gZWwuaWQgPT09IHRoaXMuY29uZmlnPy5oaWdodGxpZ2h0ID8gJ2NvbnRhaW5lZCcgOiAnb3V0bGluZWQnXG4gICAgICAgIGNvbnN0IGlzRGlzYWJsZWQgPSBlbC5pZCA9PT0gdGhpcy5jb25maWc/LnN1YnNjcmlwdGlvbklkID8gJ2Rpc2FibGVkJyA6ICcnXG5cbiAgICAgICAgdGVtcG9yYXJ5Q2FyZCArPSBgXG4gICAgICAgICAgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC1jYXJkXCIgZGF0YS10YXJpZmZpZD1cIiR7ZWwuaWR9XCIgPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC1jYXJkLW5hbWUgc3VidGl0bGUyXCI+JHtlbC5uYW1lfTwvZGl2PlxuICAgICAgICAgICAgPGg1IGNsYXNzPVwic2Fhcy1zaG9wLXByaWNlLXZhbHVlXCI+XG4gICAgICAgICAgICAgICR7ZWwucHJpY2UudG9Mb2NhbGVTdHJpbmcoKX0g4oK9XG4gICAgICAgICAgICAgICA8c3Bhbj4g4oK9IDwvc3Bhbj5cbiAgICAgICAgICAgIDwvaDU+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2Fhcy1zaG9wLXByaWNlLXRleHQgYm9keTJcIj7Qt9CwINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjyDQsiA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzYWFzLXNob3AtZGVzY3JpcHRpb24gYm9keTJcIj4ke2VsLmRlc2NyaXB0aW9ufTwvZGl2PlxuICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwic2Fhcy1zaG9wLWNhcmQtYnV0dG9uLWNvbnRhaW5lciAke3N0eWxlRm9yQnRufSBsYXJnZVwiIGRpc2FibGVkPSR7aXNEaXNhYmxlZH0+PC9idXR0b24+XG4gICAgICAgICAgPC9kaXY+ICAgIFxuICAgICAgICAgIGBcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdGVtcG9yYXJ5Q2FyZFxuICAgIH1cblxuICAgIGNvbnN0IGNvdW50TGljZW5zZXMgPSBpc0NvdW50Q29udGFpbmVyXG4gICAgICA/IGA8ZGl2IGNsYXNzPVwic2Fhcy1zaG9wLWNvdW50LWNvbnRhaW5lclwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC1mb3JtLW1pbnVzXCI+PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYm9keTJcIj5cbiAgICAgICAgICAgICAgPGlucHV0IGNsYXNzPVwic2Fhcy1zaG9wLWZvcm0taW5wdXRcIiB0eXBlPVwibnVtYmVyXCIgbmFtZT1cImNvdW50XCIgbWluPVwiMVwiICBtYXg9XCIke21heGltdW1Vc2Vyc31cIiB2YWx1ZT1cIjFcIiBcbiAgICAgICAgICAgICAgICAgICAgICBvbmtleWRvd249XCJ0aGlzLnN0eWxlLndpZHRoID0gKCh0aGlzLnZhbHVlLmxlbmd0aCsxICkgKiA5KSArICdweCc7XCIgb25rZXl1cD1cImlmKHRoaXMudmFsdWU8MCkgdmFsdWU9MTtcIj5cbiAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJzYWFzLXNob3AtY291bnQtbmFtZVwiPtC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjDwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC1mb3JtLXBsdXNcIj48L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5gXG4gICAgICA6ICcnXG5cbiAgICBjb25zdCB0ZW1wb3JhcnlXaWRnZXQgPSBgXG4gICAgICA8ZGl2IGNsYXNzPVwic2Fhcy1zaG9wLWNvbnRhaW5lclwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwic2Fhcy1zaG9wLXRpdGxlXCI+0JLRi9Cx0LXRgNC40YLQtSDQv9C+0LTQv9C40YHQutGDPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzYWFzLXNob3AtY29tbW9uLWZvcm1cIj5cbiAgICAgICAgICR7Y291bnRMaWNlbnNlc31cbiAgICAgICAgICA8bGFiZWwgY2xhc3M9XCJzYWFzLXNob3AtcGVyaW9kLWNvbnRhaW5lclwiPlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIGNsYXNzPVwic2Fhcy1zaG9wLXBlcmlvZC1pbnB1dFwiPlxuICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInNhYXMtc2hvcC1wZXJpb2QtbW9udGhcIj5cbiAgICAgICAgICAgICDQnNC10YHRj9GH0L3QsNGPXG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJzYWFzLXNob3AtcGVyaW9kLXllYXJcIj5cbiAgICAgICAgICAgICDQk9C+0LTQvtCy0LDRj1xuICAgICAgICAgICAgPC9idXR0b24+ICBcbiAgICAgICAgICAgICR7ZGlzY291bnQgPyBgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC1wZXJpb2Qtc2FsZVwiID4gLSAke2Rpc2NvdW50fSUgPC9kaXY+YCA6ICcnfVxuICAgICAgICAgIDwvbGFiZWw+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic2Fhcy1zaG9wLWNhcmQtY29udGFpbmVyXCI+IFxuICAgICAgICAgICR7b3V0cHV0Q2FyZExpc3QoKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5gXG5cbiAgICB3aWRnZXRCb3guaW5uZXJIVE1MICs9IHRlbXBvcmFyeVdpZGdldFxuXG4gICAgdGhpcy5jYXJkTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zYWFzLXNob3AtY2FyZCcpXG4gICAgdGhpcy5pbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zYWFzLXNob3AtZm9ybS1pbnB1dCcpXG4gICAgdGhpcy5wbHVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1mb3JtLXBsdXMnKVxuICAgIHRoaXMubWludXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2Fhcy1zaG9wLWZvcm0tbWludXMnKVxuICAgIHRoaXMucGVyaW9kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1wZXJpb2QtaW5wdXQnKVxuICAgIHRoaXMuY291bnROYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1jb3VudC1uYW1lJylcbiAgICB0aGlzLm1vbnRoUGVyaW9kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1wZXJpb2QtbW9udGgnKVxuICAgIHRoaXMueWVhclBlcmlvZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zYWFzLXNob3AtcGVyaW9kLXllYXInKVxuXG4gICAgdGhpcy5jaGVja1RhcmlmZih0YXJpZmZMaXN0KVxuXG4gICAgdGhpcy5pbnB1dD8uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4ge1xuICAgICAgdGhpcy5jaGVja1RhcmlmZih0YXJpZmZMaXN0KVxuICAgIH0pXG4gICAgdGhpcy5wbHVzPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIHRoaXMuY2FsY1BsdXModGhpcy5wbHVzLCBtYXhpbXVtVXNlcnMpXG4gICAgICB0aGlzLmNoZWNrVGFyaWZmKHRhcmlmZkxpc3QpXG4gICAgfSlcbiAgICB0aGlzLm1pbnVzPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIHRoaXMuY2FsY01pbnVzKHRoaXMubWludXMpXG4gICAgICB0aGlzLmNoZWNrVGFyaWZmKHRhcmlmZkxpc3QpXG4gICAgfSlcblxuICAgIHRoaXMubW9udGhQZXJpb2Q/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7XG4gICAgICB0aGlzLnNldFBlcmlvZChldmVudC50YXJnZXQsIGZhbHNlKVxuICAgIH0pXG5cbiAgICB0aGlzLnllYXJQZXJpb2Q/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7XG4gICAgICB0aGlzLnNldFBlcmlvZChldmVudC50YXJnZXQsIHRydWUpXG4gICAgfSlcbiAgICB0aGlzLnBlcmlvZD8ucGFyZW50Tm9kZSEuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICB0aGlzLmNoZWNrVGFyaWZmKHRhcmlmZkxpc3QpXG4gICAgfSlcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tMaWNlbnNlc0NvdW50ID0gKGVsOiBIVE1MRGl2RWxlbWVudCwgaW5wdXRWYWx1ZTogbnVtYmVyLCB0YXJpZmY6IElQbGFuKSA9PiB7XG4gICAgY29uc3QgYnRuID0gZWwucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1jYXJkLWJ1dHRvbi1jb250YWluZXInKVxuICAgIGlmIChpbnB1dFZhbHVlID4gdGFyaWZmLm1heExpY2Vuc2VDb3VudCAmJiB0YXJpZmYubWluTGljZW5zZUNvdW50ICE9PSB0YXJpZmYubWF4TGljZW5zZUNvdW50KSB7XG4gICAgICBidG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpXG4gICAgICByZXR1cm4gYNCU0L4gJHt0YXJpZmYubWF4TGljZW5zZUNvdW50fSAke3RoaXMuY29uZGl0aW9uVXNlclRleHQodGFyaWZmLm1heExpY2Vuc2VDb3VudCl9YFxuICAgIH0gZWxzZSBpZiAoaW5wdXRWYWx1ZSA8IHRhcmlmZi5taW5MaWNlbnNlQ291bnQgJiYgdGFyaWZmLm1heExpY2Vuc2VDb3VudCAhPT0gdGFyaWZmLm1pbkxpY2Vuc2VDb3VudCkge1xuICAgICAgYnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnZGlzYWJsZWQnKVxuICAgICAgcmV0dXJuIGDQntGCICR7dGFyaWZmLm1pbkxpY2Vuc2VDb3VudH0gJHt0aGlzLmNvbmRpdGlvblVzZXJUZXh0KHRhcmlmZi5taW5MaWNlbnNlQ291bnQpfWBcbiAgICB9IGVsc2Uge1xuICAgICAgYnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0QnV0dG9uID0gKGVsOiBIVE1MRGl2RWxlbWVudCwgdGFyaWZmOiBJUGxhbiwgcmVhc29uPzogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgYnV0dG9uID0gZWwucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1jYXJkLWJ1dHRvbi1jb250YWluZXInKVxuICAgIGxldCBwcmljZVRleHQgPSAnJ1xuXG4gICAgY29uc3Qgbm90Q3VycmVudFRhcmlmZiA9IHRoaXMuY29uZmlnPy5zdWJzY3JpcHRpb25JZCAhPT0gdGFyaWZmLmlkXG4gICAgY29uc3Qgbm90UGFja2FnZVRhcmlmZiA9IHRhcmlmZi5tYXhMaWNlbnNlQ291bnQgIT09IHRhcmlmZi5taW5MaWNlbnNlQ291bnRcbiAgICBjb25zdCBwcmljZVdpdGhEaXNjb3VudCA9IHRhcmlmZi5kaXNjb3VudFxuICAgICAgPyB0YXJpZmY/LnByaWNlICogTnVtYmVyKHRoaXMuaW5wdXQ/LnZhbHVlKSAqIDEyICogKCgxMDAgLSB0YXJpZmYuZGlzY291bnQpIC8gMTAwKVxuICAgICAgOiB0YXJpZmY/LnByaWNlICogTnVtYmVyKHRoaXMuaW5wdXQ/LnZhbHVlKSAqIDEyXG5cbiAgICBjb25zdCBwcmljZSA9ICh0aGlzLnBlcmlvZC5jaGVja2VkID8gcHJpY2VXaXRoRGlzY291bnQgOiB0YXJpZmY/LnByaWNlICogTnVtYmVyKHRoaXMuaW5wdXQ/LnZhbHVlKSkudG9Mb2NhbGVTdHJpbmcoKVxuXG4gICAgaWYgKHRhcmlmZj8ucHJpY2UgJiYgbm90Q3VycmVudFRhcmlmZiAmJiAhcmVhc29uICYmIHRoaXMuaW5wdXQgJiYgbm90UGFja2FnZVRhcmlmZikge1xuICAgICAgcHJpY2VUZXh0ID0gYNCa0YPQv9C40YLRjCDQt9CwICR7cHJpY2V9IOKCvWBcbiAgICB9IGVsc2UgaWYgKCFub3RQYWNrYWdlVGFyaWZmICYmIG5vdEN1cnJlbnRUYXJpZmYpIHtcbiAgICAgIHByaWNlVGV4dCA9IGDQktGL0LHRgNCw0YLRjCAke3RhcmlmZi5uYW1lfWBcbiAgICB9IGVsc2UgaWYgKHJlYXNvbikge1xuICAgICAgcHJpY2VUZXh0ID0gcmVhc29uXG4gICAgfSBlbHNlIHtcbiAgICAgIHByaWNlVGV4dCA9ICfQotC10LrRg9GJ0LjQuSDRgtCw0YDQuNGEJ1xuICAgIH1cblxuICAgIGNvbnN0IGhyZWYgPSB0aGlzLmNyZWF0ZUhyZWYodGFyaWZmKVxuXG4gICAgaWYgKCFub3RDdXJyZW50VGFyaWZmKSBidXR0b24uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpXG5cbiAgICBidXR0b24uaW5uZXJIVE1MID0gYFxuICAgICAgPHAgY2xhc3M9XCJzYWFzLXNob3AtY2FyZC1idXR0b24taHJlZlwiPlxuICAgICAgICAgICR7cHJpY2VUZXh0fVxuICAgICAgPC9wPlxuICAgICAgYFxuXG4gICAgLy9AdHMtaWdub3JlXG4gICAgYnV0dG9uLm9uY2xpY2sgPSAoKSA9PiB7XG4gICAgICB3aW5kb3cub3BlbihocmVmLCAnX2JsYW5rJylcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNoZWNrVGFyaWZmID0gKHRhcmlmZkxpc3Q6IElQbGFuW10pID0+IHtcbiAgICAvL0B0cy1pZ25vcmVcbiAgICB0aGlzLmlucHV0Py52YWx1ZSA9IE51bWJlcih0aGlzLmlucHV0IS52YWx1ZSkgPiA5OTk5OSA/IDk5OTk5IDogTnVtYmVyKHRoaXMuaW5wdXQ/LnZhbHVlKVxuICAgIGlmICh0aGlzLmlucHV0KSB0aGlzLmlucHV0LnN0eWxlLndpZHRoID0gdGhpcy5pbnB1dC52YWx1ZS5sZW5ndGggKiA5ICsgJ3B4J1xuICAgIGlmICh0aGlzLmNvdW50TmFtZSkgdGhpcy5jb3VudE5hbWUudGV4dENvbnRlbnQgPSB0aGlzLnVzZXJUZXh0KE51bWJlcih0aGlzLmlucHV0Py52YWx1ZSkpXG5cbiAgICBmb3IgKGNvbnN0IGVsIG9mIHRoaXMuY2FyZExpc3QpIHtcbiAgICAgIGNvbnN0IHRhcmlmZiA9IHRhcmlmZkxpc3QuZmluZCgoaXRlbSkgPT4gaXRlbS5pZC50b1N0cmluZygpID09PSBlbC5kYXRhc2V0LnRhcmlmZmlkKVxuICAgICAgY29uc3QgcmVhc29uID0gdGhpcy5jaGVja0xpY2Vuc2VzQ291bnQoZWwsIE51bWJlcih0aGlzLmlucHV0Py52YWx1ZSksIHRhcmlmZilcblxuICAgICAgdGhpcy5zZXRCdXR0b24oZWwsIHRhcmlmZiwgcmVhc29uKVxuXG4gICAgICBjb25zdCBwcmljZVRleHQgPSBlbC5xdWVyeVNlbGVjdG9yKCcuc2Fhcy1zaG9wLXByaWNlLXRleHQnKVxuICAgICAgY29uc3QgcHJpY2UgPSBlbC5xdWVyeVNlbGVjdG9yKCcuc2Fhcy1zaG9wLXByaWNlLXZhbHVlJylcbiAgICAgIGNvbnN0IHZhcmlhYmxlT2ZQZXJpb2QgPSB0aGlzLnBlcmlvZC5jaGVja2VkID8gJ9C30LAg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPINCyINCz0L7QtCcgOiAn0LfQsCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8g0LIg0LzQtdGB0Y/RhidcbiAgICAgIGNvbnN0IHllYXJQcmljZVdpdGhEaXNjb3VudCA9XG4gICAgICAgIHRoaXMucGVyaW9kLmNoZWNrZWQgJiYgdGFyaWZmLmRpc2NvdW50XG4gICAgICAgICAgPyAodGFyaWZmLnByaWNlICogMTIgKiAoKDEwMCAtIHRhcmlmZi5kaXNjb3VudCkgLyAxMDApKS50b0xvY2FsZVN0cmluZygpXG4gICAgICAgICAgOiAodGFyaWZmLnByaWNlICogMTIpLnRvTG9jYWxlU3RyaW5nKClcblxuICAgICAgcHJpY2VUZXh0LnRleHRDb250ZW50ID1cbiAgICAgICAgdGFyaWZmLm1heExpY2Vuc2VDb3VudCA9PT0gdGFyaWZmLm1pbkxpY2Vuc2VDb3VudFxuICAgICAgICAgID8gYNC00L4gJHt0YXJpZmYubWF4TGljZW5zZUNvdW50fSDQv9C+0LvRjNC30L7QstCw0YLQtdC70LXQuWBcbiAgICAgICAgICA6IHZhcmlhYmxlT2ZQZXJpb2RcbiAgICAgIHByaWNlLnRleHRDb250ZW50ID0gdGhpcy5wZXJpb2QuY2hlY2tlZCA/IGAke3llYXJQcmljZVdpdGhEaXNjb3VudH0g4oK9YCA6IGAke3RhcmlmZi5wcmljZS50b0xvY2FsZVN0cmluZygpfSDigr1gXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVIcmVmID0gKHRhcmlmZjogSVBsYW4pID0+IHtcbiAgICBjb25zdCBhbm51YWxseSA9IHRoaXMucGVyaW9kLmNoZWNrZWQgPyAnJmFubnVhbGx5PXRydWUnIDogJydcbiAgICBjb25zdCBsaWNlbnNlc0NvdW50ID1cbiAgICAgIHRoaXMuaW5wdXQ/LnZhbHVlICYmIHRhcmlmZi5tYXhMaWNlbnNlQ291bnQgIT09IHRhcmlmZi5taW5MaWNlbnNlQ291bnRcbiAgICAgICAgPyB0aGlzLmlucHV0Py52YWx1ZVxuICAgICAgICA6IHRhcmlmZi5tYXhMaWNlbnNlQ291bnRcblxuICAgIHJldHVybiAoXG4gICAgICB0aGlzLnJlZGlyZWN0VXJsICtcbiAgICAgIGAvY2hlY2tvdXQ/cHJvZHVjdElkPSR7dGhpcy5wcm9kdWN0SWR9JnRhcmlmZklkPSR7dGFyaWZmLmlkfSR7YW5udWFsbHl9JmxpY2Vuc2VzQ291bnQ9JHtsaWNlbnNlc0NvdW50fWBcbiAgICApXG4gIH1cblxuICBwcml2YXRlIGNhbGNQbHVzID0gKGVsOiBIVE1MRGl2RWxlbWVudCwgbWF4OiBudW1iZXIpID0+IHtcbiAgICBjb25zdCBpbnB1dDogSFRNTElucHV0RWxlbWVudCA9IGVsPy5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoJy5zYWFzLXNob3AtZm9ybS1pbnB1dCcpXG4gICAgY29uc3QgY291bnQgPSBwYXJzZUludChpbnB1dC52YWx1ZSkgKyAxXG5cbiAgICBpZiAobWF4ID49IGNvdW50KSB7XG4gICAgICAvL0B0cy1pZ25vcmVcbiAgICAgIGlucHV0LnZhbHVlID0gY291bnRcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNhbGNNaW51cyA9IChlbDogSFRNTERpdkVsZW1lbnQpID0+IHtcbiAgICBsZXQgaW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQgPSBlbD8ucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCcuc2Fhcy1zaG9wLWZvcm0taW5wdXQnKVxuICAgIGxldCBjb3VudCA9IHBhcnNlSW50KGlucHV0LnZhbHVlKSAtIDFcblxuICAgIGlmICgxIDw9IGNvdW50KSB7XG4gICAgICAvL0B0cy1pZ25vcmVcbiAgICAgIGlucHV0LnZhbHVlID0gY291bnRcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldFBlcmlvZCA9IChlbDogYW55LCB2OiBib29sZWFuKSA9PiB7XG4gICAgY29uc3QgaW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQgPSBlbD8ucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCcuc2Fhcy1zaG9wLXBlcmlvZC1pbnB1dCcpXG4gICAgaW5wdXQuY2hlY2tlZCA9IHZcbiAgfVxuXG4gIHByaXZhdGUgdXNlclRleHQgPSAoY291bnQ6IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IGxhc3ROdW1iZXIgPSArY291bnQudG9TdHJpbmcoKS5zbGljZSgtMSlcbiAgICBjb25zdCBwcmVMYXN0TnVtYmVyID0gK2NvdW50LnRvU3RyaW5nKCkuc2xpY2UoLTIsIC0xKVxuICAgIGlmIChsYXN0TnVtYmVyID09PSAxICYmIHByZUxhc3ROdW1iZXIgIT09IDEpIHtcbiAgICAgIHJldHVybiAn0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GMJ1xuICAgIH0gZWxzZSBpZiAobGFzdE51bWJlciA+IDEgJiYgbGFzdE51bWJlciA8IDUgJiYgcHJlTGFzdE51bWJlciAhPT0gMSkge1xuICAgICAgcmV0dXJuICfQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8nXG4gICAgfSBlbHNlIHJldHVybiAn0L/QvtC70YzQt9C+0LLQsNGC0LXQu9C10LknXG4gIH1cblxuICBwcml2YXRlIGNvbmRpdGlvblVzZXJUZXh0ID0gKGNvdW50OiBudW1iZXIpID0+IHtcbiAgICByZXR1cm4gY291bnQudG9TdHJpbmcoKS5zbGljZSgtMSkgPT09ICcxJyA/ICfQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8nIDogJ9C/0L7Qu9GM0LfQvtCy0LDRgtC10LvQtdC5J1xuICB9XG59XG4iLCJpbXBvcnQgeyBXaWRnZXRTYWFzU2hvcFByZXNlbnRlciB9IGZyb20gJy4vcHJlc2VudGVyL1dpZGdldFNhYXNTaG9wUHJlc2VudGVyJ1xuaW1wb3J0ICcuL3N0eWxlLmNzcydcblxuY29uc3QgcHJvZHVjdElkID0gJzkzYzU2YTRjLTMzMjQtNDU0ZC05ZGZmLTA5NDMzNWY2NmY0MCdcbmNvbnN0IGFwaSA9ICdodHRwczovL3NhYXMtc2hvcC1hcGkuZGV2Lm1yc2FwcC5ydSdcbmNvbnN0IHJlZGlyZWN0VXJsID1cbiAgbG9jYXRpb24uaG9zdCA9PT0gJ3NhYXMtc2hvcC5kZXYubXJzYXBwLnJ1JyA/ICdodHRwczovL3NhYXMtc2hvcC1mcm9udGVuZC5kZXYubXJzYXBwLnJ1JyA6ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnXG5jb25zdCBpZENvbnRhaW5lciA9ICcuc2Fhc19zaG9wX3RhcmlmZnMnXG5cbi8vIHdpbmRvdy5XaWRnZXRDb25maWcgPSB7XG4vLyAgIHByb2R1Y3RJZDogJ2FkNWI3NGJjLWI5YWYtNGE0YS04MWE5LTIxZTcxM2NkYzIwNicsXG4vLyB9XG5cbmNvbnN0IGN1cnJlbnRQcm9kdWN0SWQgPSB3aW5kb3cuV2lkZ2V0Q29uZmlnPy5wcm9kdWN0SWQgPyB3aW5kb3cuV2lkZ2V0Q29uZmlnLnByb2R1Y3RJZCA6IHByb2R1Y3RJZFxuXG52YXIgTmV3V2lkZ2V0ID0gbmV3IFdpZGdldFNhYXNTaG9wUHJlc2VudGVyKHtcbiAgaWRDb250YWluZXIsXG4gIGFwaSxcbiAgcmVkaXJlY3RVcmwsXG4gIHByb2R1Y3RJZDogY3VycmVudFByb2R1Y3RJZCxcbn0pXG5cbmlmICh3aW5kb3cuV2lkZ2V0Q29uZmlnKSB7XG4gIE5ld1dpZGdldC5pbml0KHdpbmRvdy5XaWRnZXRDb25maWcpXG59IGVsc2UgTmV3V2lkZ2V0LmluaXQoKVxuIiwiaW1wb3J0IHsgSUNvbmZpZywgSVdpZGdldFNhYXNTaG9QcmVzZW50ZXIsIElXaWRnZXRTYWFzU2hvcFBhcmFtcyB9IGZyb20gJy4vSVdpZGdldFNhYXNTaG9wJ1xuaW1wb3J0IHsgV2lkZ2V0Qm94IH0gZnJvbSAnLi93aWRnZXRCb3gvV2lkZ2V0Qm94J1xuXG5leHBvcnQgY2xhc3MgV2lkZ2V0U2Fhc1Nob3BQcmVzZW50ZXIgaW1wbGVtZW50cyBJV2lkZ2V0U2Fhc1Nob1ByZXNlbnRlciB7XG4gIGlkQ29udGFpbmVyOiBzdHJpbmcgPSAnJ1xuICBhcGk6IHN0cmluZyA9ICcnXG4gIHJlZGlyZWN0VXJsOiBzdHJpbmcgPSAnJ1xuICBwcm9kdWN0SWQ6IHN0cmluZyB8IG51bGwgPSBudWxsXG5cbiAgY29uc3RydWN0b3IocGFyYW1zOiBJV2lkZ2V0U2Fhc1Nob3BQYXJhbXMpIHtcbiAgICB0aGlzLmlkQ29udGFpbmVyID0gcGFyYW1zLmlkQ29udGFpbmVyXG4gICAgdGhpcy5hcGkgPSBwYXJhbXMuYXBpXG4gICAgdGhpcy5yZWRpcmVjdFVybCA9IHBhcmFtcy5yZWRpcmVjdFVybFxuICAgIHRoaXMucHJvZHVjdElkID0gcGFyYW1zLnByb2R1Y3RJZFxuICB9XG5cbiAgaW5pdChjb25maWc/OiBJQ29uZmlnKTogdm9pZCB7XG4gICAgZmV0Y2godGhpcy5hcGkgKyAnL3Byb2R1Y3RzLycgKyB0aGlzLnByb2R1Y3RJZCArICcvcGxhbnMnKVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IocmVzcG9uc2Uuc3RhdHVzVGV4dCkpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXNwb25zZSlcbiAgICAgIH0pXG4gICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKVxuICAgICAgfSlcbiAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuaWRDb250YWluZXIpKSB7XG4gICAgICAgICAgY29uc3Qgd2lkZ2V0Qm94ID0gbmV3IFdpZGdldEJveCh7XG4gICAgICAgICAgICB3aWRnZXRCb3g6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5pZENvbnRhaW5lciksXG4gICAgICAgICAgICByZWRpcmVjdFVybDogdGhpcy5yZWRpcmVjdFVybCxcbiAgICAgICAgICAgIHByb2R1Y3RJZDogdGhpcy5wcm9kdWN0SWQsXG4gICAgICAgICAgICBwbGFuczogZGF0YSxcbiAgICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICB9KVxuICAgICAgICAgIHdpZGdldEJveC53aWRnZXRDcmVhdGUoKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFsZXJ0KCdDb250YWluZXIgd2l0aCBpZCAnICsgdGhpcy5pZENvbnRhaW5lciArICcgbm90IGZvdW5kIScpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yKVxuICAgICAgfSlcbiAgfVxufVxuIl0sIm5hbWVzIjpbIldpZGdldEJveCIsImNvbnN0cnVjdG9yIiwicGFyYW1zIiwid2lkZ2V0Qm94IiwidW5kZWZpbmVkIiwicmVkaXJlY3RVcmwiLCJwcm9kdWN0SWQiLCJjYXJkTGlzdCIsImlucHV0IiwicGx1cyIsIm1pbnVzIiwicGVyaW9kIiwiY291bnROYW1lIiwibW9udGhQZXJpb2QiLCJ5ZWFyUGVyaW9kIiwid2lkZ2V0Q3JlYXRlIiwidGhpcyIsInRhcmlmZkxpc3QiLCJwbGFucyIsImRpc2NvdW50IiwibWF4aW11bVVzZXJzIiwiaXNDb3VudENvbnRhaW5lciIsImZvckVhY2giLCJlbCIsIm1heExpY2Vuc2VDb3VudCIsIm1pbkxpY2Vuc2VDb3VudCIsInRlbXBvcmFyeVdpZGdldCIsInRlbXBvcmFyeUNhcmQiLCJzdHlsZUZvckJ0biIsImlkIiwiY29uZmlnIiwiaGlnaHRsaWdodCIsImlzRGlzYWJsZWQiLCJzdWJzY3JpcHRpb25JZCIsIm5hbWUiLCJwcmljZSIsInRvTG9jYWxlU3RyaW5nIiwiZGVzY3JpcHRpb24iLCJvdXRwdXRDYXJkTGlzdCIsImlubmVySFRNTCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsInF1ZXJ5U2VsZWN0b3IiLCJjaGVja1RhcmlmZiIsImFkZEV2ZW50TGlzdGVuZXIiLCJjYWxjUGx1cyIsImNhbGNNaW51cyIsImV2ZW50Iiwic2V0UGVyaW9kIiwidGFyZ2V0IiwicGFyZW50Tm9kZSIsImNoZWNrTGljZW5zZXNDb3VudCIsImlucHV0VmFsdWUiLCJ0YXJpZmYiLCJidG4iLCJzZXRBdHRyaWJ1dGUiLCJjb25kaXRpb25Vc2VyVGV4dCIsInJlbW92ZUF0dHJpYnV0ZSIsInNldEJ1dHRvbiIsInJlYXNvbiIsImJ1dHRvbiIsInByaWNlVGV4dCIsIm5vdEN1cnJlbnRUYXJpZmYiLCJub3RQYWNrYWdlVGFyaWZmIiwicHJpY2VXaXRoRGlzY291bnQiLCJOdW1iZXIiLCJ2YWx1ZSIsImNoZWNrZWQiLCJocmVmIiwiY3JlYXRlSHJlZiIsIm9uY2xpY2siLCJ3aW5kb3ciLCJvcGVuIiwic3R5bGUiLCJ3aWR0aCIsImxlbmd0aCIsInRleHRDb250ZW50IiwidXNlclRleHQiLCJmaW5kIiwiaXRlbSIsInRvU3RyaW5nIiwiZGF0YXNldCIsInRhcmlmZmlkIiwidmFyaWFibGVPZlBlcmlvZCIsInllYXJQcmljZVdpdGhEaXNjb3VudCIsImFubnVhbGx5IiwibGljZW5zZXNDb3VudCIsIm1heCIsImNvdW50IiwicGFyc2VJbnQiLCJ2IiwibGFzdE51bWJlciIsInNsaWNlIiwicHJlTGFzdE51bWJlciIsImxvY2F0aW9uIiwiaG9zdCIsImN1cnJlbnRQcm9kdWN0SWQiLCJXaWRnZXRDb25maWciLCJOZXdXaWRnZXQiLCJpZENvbnRhaW5lciIsImFwaSIsImluaXQiLCJmZXRjaCIsInRoZW4iLCJyZXNwb25zZSIsInN0YXR1cyIsIlByb21pc2UiLCJyZWplY3QiLCJFcnJvciIsInN0YXR1c1RleHQiLCJyZXNvbHZlIiwianNvbiIsImRhdGEiLCJhbGVydCIsImNhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIl0sInNvdXJjZVJvb3QiOiIifQ==