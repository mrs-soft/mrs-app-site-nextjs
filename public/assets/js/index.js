(() => { "use strict"; class t { constructor(t) { this.widgetBox = void 0, this.redirectUrl = "", this.productId = null, this.cardList = null, this.input = null, this.plus = null, this.minus = null, this.period = null, this.countName = null, this.monthPeriod = null, this.yearPeriod = null, this.widgetCreate = () => { var t, i, s, e, n, o; const a = this.widgetBox, r = this.plans || []; let c = 0, d = 1, u = !1; r.forEach((t => { t.maxLicenseCount > d && (d = t.maxLicenseCount), t.discount > c && (c = t.discount), t.maxLicenseCount === t.minLicenseCount || u || (u = !0) })); const l = `\n      <div class="saas-shop-container">\n        <div class="saas-shop-title">Выберите подписку</div>\n        <div class="saas-shop-common-form">\n         ${u ? `<div class="saas-shop-count-container">\n            <div class="saas-shop-form-minus"></div>\n            <div class="body2">\n              <input class="saas-shop-form-input" type="number" name="count" min="1"  max="${d}" value="1" \n                      onkeydown="this.style.width = ((this.value.length+1 ) * 9) + 'px';" onkeyup="if(this.value<0) value=1;">\n              <span class="saas-shop-count-name">пользователь</span>\n            </div>\n            <div class="saas-shop-form-plus"></div>\n          </div>` : ""}\n          <label class="saas-shop-period-container">\n            <input type="checkbox" class="saas-shop-period-input">\n            <button class="saas-shop-period-month">\n             Месячная\n            </button>\n            <button class="saas-shop-period-year">\n             Годовая\n            </button>  \n            ${c ? `<div class="saas-shop-period-sale" > - ${c}% </div>` : ""}\n          </label>\n        </div>\n        <div class="saas-shop-card-container"> \n          ${(() => { let t = ""; return r.forEach((i => { var s, e; const n = i.id === (null === (s = this.config) || void 0 === s ? void 0 : s.hightlight) ? "contained" : "outlined", o = i.id === (null === (e = this.config) || void 0 === e ? void 0 : e.subscriptionId) ? "disabled" : ""; t += `\n          <div class="saas-shop-card" data-tariffid="${i.id}" >\n            <div class="saas-shop-card-name subtitle2">${i.name}</div>\n            <h5 class="saas-shop-price-value">\n              ${i.price.toLocaleString()} ₽\n               <span> ₽ </span>\n            </h5>\n            <div class="saas-shop-price-text body2">за пользователя в </div>\n            <div class="saas-shop-description body2">${i.description}</div>\n              <button class="saas-shop-card-button-container ${n} large" disabled=${o}></button>\n          </div>    \n          ` })), t })()}\n        </div>\n      </div>`; a.innerHTML += l, this.cardList = document.querySelectorAll(".saas-shop-card"), this.input = document.querySelector(".saas-shop-form-input"), this.plus = document.querySelector(".saas-shop-form-plus"), this.minus = document.querySelector(".saas-shop-form-minus"), this.period = document.querySelector(".saas-shop-period-input"), this.countName = document.querySelector(".saas-shop-count-name"), this.monthPeriod = document.querySelector(".saas-shop-period-month"), this.yearPeriod = document.querySelector(".saas-shop-period-year"), this.checkTariff(r), null === (t = this.input) || void 0 === t || t.addEventListener("change", (() => { this.checkTariff(r) })), null === (i = this.plus) || void 0 === i || i.addEventListener("click", (() => { this.calcPlus(this.plus, d), this.checkTariff(r) })), null === (s = this.minus) || void 0 === s || s.addEventListener("click", (() => { this.calcMinus(this.minus), this.checkTariff(r) })), null === (e = this.monthPeriod) || void 0 === e || e.addEventListener("click", (t => { this.setPeriod(t.target, !1) })), null === (n = this.yearPeriod) || void 0 === n || n.addEventListener("click", (t => { this.setPeriod(t.target, !0) })), null === (o = this.period) || void 0 === o || o.parentNode.addEventListener("click", (() => { this.checkTariff(r) })) }, this.checkLicensesCount = (t, i, s) => { const e = t.querySelector(".saas-shop-card-button-container"); return i > s.maxLicenseCount && s.minLicenseCount !== s.maxLicenseCount ? (e.setAttribute("disabled", "disabled"), `До ${s.maxLicenseCount} ${this.conditionUserText(s.maxLicenseCount)}`) : i < s.minLicenseCount && s.maxLicenseCount !== s.minLicenseCount ? (e.setAttribute("disabled", "disabled"), `От ${s.minLicenseCount} ${this.conditionUserText(s.minLicenseCount)}`) : void e.removeAttribute("disabled") }, this.setButton = (t, i, s) => { var e, n, o, a; const r = t.querySelector(".saas-shop-card-button-container"); let c = ""; const d = (null === (e = this.config) || void 0 === e ? void 0 : e.subscriptionId) !== i.id, u = i.maxLicenseCount !== i.minLicenseCount, l = i.discount ? (null == i ? void 0 : i.price) * Number(null === (n = this.input) || void 0 === n ? void 0 : n.value) * 12 * ((100 - i.discount) / 100) : (null == i ? void 0 : i.price) * Number(null === (o = this.input) || void 0 === o ? void 0 : o.value) * 12, h = (this.period.checked ? l : (null == i ? void 0 : i.price) * Number(null === (a = this.input) || void 0 === a ? void 0 : a.value)).toLocaleString(); c = (null == i ? void 0 : i.price) && d && !s && this.input && u ? `Купить за ${h} ₽` : !u && d ? `Выбрать ${i.name}` : s || "Текущий тариф"; const p = this.createHref(i); d || r.setAttribute("disabled", "disabled"), r.innerHTML = `\n      <a class="saas-shop-card-button-href" href="${p}" target="_blank">\n          ${c}\n      </a>\n      ` }, this.checkTariff = t => { var i, s, e, n; null === (i = this.input) || void 0 === i || (i.value = Number(this.input.value) > 99999 ? 99999 : Number(null === (s = this.input) || void 0 === s ? void 0 : s.value)), this.input && (this.input.style.width = 9 * this.input.value.length + "px"), this.countName && (this.countName.textContent = this.userText(Number(null === (e = this.input) || void 0 === e ? void 0 : e.value))); for (const i of this.cardList) { const s = t.find((t => t.id.toString() === i.dataset.tariffid)), e = this.checkLicensesCount(i, Number(null === (n = this.input) || void 0 === n ? void 0 : n.value), s); this.setButton(i, s, e); const o = i.querySelector(".saas-shop-price-text"), a = i.querySelector(".saas-shop-price-value"), r = this.period.checked ? "за пользователя в год" : "за пользователя в месяц", c = this.period.checked && s.discount ? (12 * s.price * ((100 - s.discount) / 100)).toLocaleString() : (12 * s.price).toLocaleString(); o.textContent = s.maxLicenseCount === s.minLicenseCount ? `до ${s.maxLicenseCount} пользователей` : r, a.textContent = this.period.checked ? `${c} ₽` : `${s.price.toLocaleString()} ₽` } }, this.createHref = t => { var i, s; const e = this.period.checked ? "&annually=true" : "", n = (null === (i = this.input) || void 0 === i ? void 0 : i.value) && t.maxLicenseCount !== t.minLicenseCount ? null === (s = this.input) || void 0 === s ? void 0 : s.value : t.maxLicenseCount; return this.redirectUrl + `/#/checkout?productId=${this.productId}&tariffId=${t.id}${e}&licensesCount=${n}` }, this.calcPlus = (t, i) => { const s = null == t ? void 0 : t.parentNode.querySelector(".saas-shop-form-input"), e = parseInt(s.value) + 1; i >= e && (s.value = e) }, this.calcMinus = t => { let i = null == t ? void 0 : t.parentNode.querySelector(".saas-shop-form-input"), s = parseInt(i.value) - 1; 1 <= s && (i.value = s) }, this.setPeriod = (t, i) => { (null == t ? void 0 : t.parentNode.querySelector(".saas-shop-period-input")).checked = i }, this.userText = t => { const i = +t.toString().slice(-1), s = +t.toString().slice(-2, -1); return 1 === i && 1 !== s ? "пользователь" : i > 1 && i < 5 && 1 !== s ? "пользователя" : "пользователей" }, this.conditionUserText = t => "1" === t.toString().slice(-1) ? "пользователя" : "пользователей", this.widgetBox = t.widgetBox, this.redirectUrl = t.redirectUrl, this.productId = t.productId, this.plans = t.plans, this.config = t.config } } var i; const s = "saas-shop.citronium.com" === location.host ? "https://account.saas-shop.citronium.com" : "http://localhost:4001", e = (null === (i = window.WidgetConfig) || void 0 === i ? void 0 : i.productId) ? window.WidgetConfig.productId : "93c56a4c-3324-454d-9dff-094335f66f40"; var n = new class { constructor(t) { this.idContainer = "", this.api = "", this.redirectUrl = "", this.productId = null, this.idContainer = t.idContainer, this.api = t.api, this.redirectUrl = t.redirectUrl, this.productId = t.productId } init(i) { fetch(this.api + "/products/" + this.productId + "/plans").then((function (t) { return 200 !== t.status ? Promise.reject(new Error(t.statusText)) : Promise.resolve(t) })).then((function (t) { return t.json() })).then((s => { document.querySelector(this.idContainer) ? new t({ widgetBox: document.querySelector(this.idContainer), redirectUrl: this.redirectUrl, productId: this.productId, plans: s, config: i }).widgetCreate() : alert("Container with id " + this.idContainer + " not found!") })).catch((t => { console.log(t) })) } }({ idContainer: ".saas_shop_tariffs", api: "https://saas-shop-api.dev.mrsapp.ru", redirectUrl: s, productId: e }); window.WidgetConfig ? n.init(window.WidgetConfig) : n.init() })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VUFDaEJZLE1BQU80RixFQUNQaEYsV0FFUWYsZUFFVmdHLE1BQU0scUJBQXVCL0YsS0FBS2lGLFlBQWMsYyxJQUduRGUsT0FBT0MsSUFDTkMsUUFBUUMsSUFBSUYsRUFBTSxHQUV4QixHRGpDMEMsQ0FDMUNoQixZQUxrQixxQkFNbEJDLElBVFUsc0NBVVY3RixjQUNBQyxVQUFXdUYsSUFHVEMsT0FBT0MsYUFDVEMsRUFBVUcsS0FBS0wsT0FBT0MsY0FDakJDLEVBQVVHLE0iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYWFzLXNob3Atc2l0ZS8uL3NyYy9wcmVzZW50ZXIvd2lkZ2V0Qm94L1dpZGdldEJveC50cyIsIndlYnBhY2s6Ly9zYWFzLXNob3Atc2l0ZS8uL3NyYy9pbmRleC50cyIsIndlYnBhY2s6Ly9zYWFzLXNob3Atc2l0ZS8uL3NyYy9wcmVzZW50ZXIvV2lkZ2V0U2Fhc1Nob3BQcmVzZW50ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSUNvbmZpZyB9IGZyb20gJy4uL0lXaWRnZXRTYWFzU2hvcCdcbmltcG9ydCB7IElQbGFuLCBJV2lkZ2V0Qm94LCBJV2lkZ2V0Qm94UGFyYW1zIH0gZnJvbSAnLi9JV2lkZ2V0Qm94J1xuXG5leHBvcnQgY2xhc3MgV2lkZ2V0Qm94IGltcGxlbWVudHMgSVdpZGdldEJveCB7XG4gIHdpZGdldEJveDogSFRNTERpdkVsZW1lbnQgfCB1bmRlZmluZWQgPSB1bmRlZmluZWRcbiAgcmVkaXJlY3RVcmw6IHN0cmluZyA9ICcnXG4gIHByb2R1Y3RJZDogc3RyaW5nIHwgbnVsbCA9IG51bGxcbiAgcGxhbnM6IElQbGFuW11cbiAgY29uZmlnOiBJQ29uZmlnXG5cbiAgcHJpdmF0ZSBjYXJkTGlzdDogTm9kZUxpc3RPZjxIVE1MRGl2RWxlbWVudD4gfCBudWxsID0gbnVsbFxuICBwcml2YXRlIGlucHV0OiBIVE1MSW5wdXRFbGVtZW50IHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBwbHVzOiBIVE1MRGl2RWxlbWVudCB8IG51bGwgPSBudWxsXG4gIHByaXZhdGUgbWludXM6IEhUTUxEaXZFbGVtZW50IHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBwZXJpb2Q6IEhUTUxJbnB1dEVsZW1lbnQgfCBudWxsID0gbnVsbFxuICBwcml2YXRlIGNvdW50TmFtZTogSFRNTFNwYW5FbGVtZW50IHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBtb250aFBlcmlvZDogSFRNTEJ1dHRvbkVsZW1lbnQgfCBudWxsID0gbnVsbFxuICBwcml2YXRlIHllYXJQZXJpb2Q6IEhUTUxCdXR0b25FbGVtZW50IHwgbnVsbCA9IG51bGxcblxuICBjb25zdHJ1Y3RvcihwYXJhbXM6IElXaWRnZXRCb3hQYXJhbXMpIHtcbiAgICB0aGlzLndpZGdldEJveCA9IHBhcmFtcy53aWRnZXRCb3hcbiAgICB0aGlzLnJlZGlyZWN0VXJsID0gcGFyYW1zLnJlZGlyZWN0VXJsXG4gICAgdGhpcy5wcm9kdWN0SWQgPSBwYXJhbXMucHJvZHVjdElkXG4gICAgdGhpcy5wbGFucyA9IHBhcmFtcy5wbGFuc1xuICAgIHRoaXMuY29uZmlnID0gcGFyYW1zLmNvbmZpZ1xuICB9XG5cbiAgd2lkZ2V0Q3JlYXRlID0gKCk6IHZvaWQgPT4ge1xuICAgIGNvbnN0IHdpZGdldEJveCA9IHRoaXMud2lkZ2V0Qm94XG4gICAgY29uc3QgdGFyaWZmTGlzdDogSVBsYW5bXSA9IHRoaXMucGxhbnMgfHwgW11cbiAgICBsZXQgZGlzY291bnQ6IG51bWJlciA9IDBcbiAgICBsZXQgbWF4aW11bVVzZXJzOiBudW1iZXIgPSAxXG4gICAgbGV0IGlzQ291bnRDb250YWluZXIgPSBmYWxzZVxuXG4gICAgdGFyaWZmTGlzdC5mb3JFYWNoKChlbCkgPT4ge1xuICAgICAgaWYgKGVsLm1heExpY2Vuc2VDb3VudCA+IG1heGltdW1Vc2Vycykge1xuICAgICAgICBtYXhpbXVtVXNlcnMgPSBlbC5tYXhMaWNlbnNlQ291bnRcbiAgICAgIH1cblxuICAgICAgaWYgKGVsLmRpc2NvdW50ID4gZGlzY291bnQpIHtcbiAgICAgICAgZGlzY291bnQgPSBlbC5kaXNjb3VudFxuICAgICAgfVxuXG4gICAgICBpZiAoZWwubWF4TGljZW5zZUNvdW50ICE9PSBlbC5taW5MaWNlbnNlQ291bnQgJiYgIWlzQ291bnRDb250YWluZXIpIHtcbiAgICAgICAgaXNDb3VudENvbnRhaW5lciA9IHRydWVcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgY29uc3Qgb3V0cHV0Q2FyZExpc3QgPSAoKSA9PiB7XG4gICAgICBsZXQgdGVtcG9yYXJ5Q2FyZCA9IGBgXG4gICAgICB0YXJpZmZMaXN0LmZvckVhY2goKGVsKSA9PiB7XG4gICAgICAgIGNvbnN0IHN0eWxlRm9yQnRuID0gZWwuaWQgPT09IHRoaXMuY29uZmlnPy5oaWdodGxpZ2h0ID8gJ2NvbnRhaW5lZCcgOiAnb3V0bGluZWQnXG4gICAgICAgIGNvbnN0IGlzRGlzYWJsZWQgPSBlbC5pZCA9PT0gdGhpcy5jb25maWc/LnN1YnNjcmlwdGlvbklkID8gJ2Rpc2FibGVkJyA6ICcnXG5cbiAgICAgICAgdGVtcG9yYXJ5Q2FyZCArPSBgXG4gICAgICAgICAgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC1jYXJkXCIgZGF0YS10YXJpZmZpZD1cIiR7ZWwuaWR9XCIgPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC1jYXJkLW5hbWUgc3VidGl0bGUyXCI+JHtlbC5uYW1lfTwvZGl2PlxuICAgICAgICAgICAgPGg1IGNsYXNzPVwic2Fhcy1zaG9wLXByaWNlLXZhbHVlXCI+XG4gICAgICAgICAgICAgICR7ZWwucHJpY2UudG9Mb2NhbGVTdHJpbmcoKX0g4oK9XG4gICAgICAgICAgICAgICA8c3Bhbj4g4oK9IDwvc3Bhbj5cbiAgICAgICAgICAgIDwvaDU+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2Fhcy1zaG9wLXByaWNlLXRleHQgYm9keTJcIj7Qt9CwINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjyDQsiA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzYWFzLXNob3AtZGVzY3JpcHRpb24gYm9keTJcIj4ke2VsLmRlc2NyaXB0aW9ufTwvZGl2PlxuICAgICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwic2Fhcy1zaG9wLWNhcmQtYnV0dG9uLWNvbnRhaW5lciAke3N0eWxlRm9yQnRufSBsYXJnZVwiIGRpc2FibGVkPSR7aXNEaXNhYmxlZH0+PC9idXR0b24+XG4gICAgICAgICAgPC9kaXY+ICAgIFxuICAgICAgICAgIGBcbiAgICAgIH0pXG4gICAgICByZXR1cm4gdGVtcG9yYXJ5Q2FyZFxuICAgIH1cblxuICAgIGNvbnN0IGNvdW50TGljZW5zZXMgPSBpc0NvdW50Q29udGFpbmVyXG4gICAgICA/IGA8ZGl2IGNsYXNzPVwic2Fhcy1zaG9wLWNvdW50LWNvbnRhaW5lclwiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC1mb3JtLW1pbnVzXCI+PC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwiYm9keTJcIj5cbiAgICAgICAgICAgICAgPGlucHV0IGNsYXNzPVwic2Fhcy1zaG9wLWZvcm0taW5wdXRcIiB0eXBlPVwibnVtYmVyXCIgbmFtZT1cImNvdW50XCIgbWluPVwiMVwiICBtYXg9XCIke21heGltdW1Vc2Vyc31cIiB2YWx1ZT1cIjFcIiBcbiAgICAgICAgICAgICAgICAgICAgICBvbmtleWRvd249XCJ0aGlzLnN0eWxlLndpZHRoID0gKCh0aGlzLnZhbHVlLmxlbmd0aCsxICkgKiA5KSArICdweCc7XCIgb25rZXl1cD1cImlmKHRoaXMudmFsdWU8MCkgdmFsdWU9MTtcIj5cbiAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJzYWFzLXNob3AtY291bnQtbmFtZVwiPtC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjDwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC1mb3JtLXBsdXNcIj48L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5gXG4gICAgICA6ICcnXG5cbiAgICBjb25zdCB0ZW1wb3JhcnlXaWRnZXQgPSBgXG4gICAgICA8ZGl2IGNsYXNzPVwic2Fhcy1zaG9wLWNvbnRhaW5lclwiPlxuICAgICAgICA8ZGl2IGNsYXNzPVwic2Fhcy1zaG9wLXRpdGxlXCI+0JLRi9Cx0LXRgNC40YLQtSDQv9C+0LTQv9C40YHQutGDPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzYWFzLXNob3AtY29tbW9uLWZvcm1cIj5cbiAgICAgICAgICR7Y291bnRMaWNlbnNlc31cbiAgICAgICAgICA8bGFiZWwgY2xhc3M9XCJzYWFzLXNob3AtcGVyaW9kLWNvbnRhaW5lclwiPlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIGNsYXNzPVwic2Fhcy1zaG9wLXBlcmlvZC1pbnB1dFwiPlxuICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInNhYXMtc2hvcC1wZXJpb2QtbW9udGhcIj5cbiAgICAgICAgICAgICDQnNC10YHRj9GH0L3QsNGPXG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJzYWFzLXNob3AtcGVyaW9kLXllYXJcIj5cbiAgICAgICAgICAgICDQk9C+0LTQvtCy0LDRj1xuICAgICAgICAgICAgPC9idXR0b24+ICBcbiAgICAgICAgICAgICR7ZGlzY291bnQgPyBgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC1wZXJpb2Qtc2FsZVwiID4gLSAke2Rpc2NvdW50fSUgPC9kaXY+YCA6ICcnfVxuICAgICAgICAgIDwvbGFiZWw+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic2Fhcy1zaG9wLWNhcmQtY29udGFpbmVyXCI+IFxuICAgICAgICAgICR7b3V0cHV0Q2FyZExpc3QoKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5gXG5cbiAgICB3aWRnZXRCb3guaW5uZXJIVE1MICs9IHRlbXBvcmFyeVdpZGdldFxuXG4gICAgdGhpcy5jYXJkTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5zYWFzLXNob3AtY2FyZCcpXG4gICAgdGhpcy5pbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zYWFzLXNob3AtZm9ybS1pbnB1dCcpXG4gICAgdGhpcy5wbHVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1mb3JtLXBsdXMnKVxuICAgIHRoaXMubWludXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2Fhcy1zaG9wLWZvcm0tbWludXMnKVxuICAgIHRoaXMucGVyaW9kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1wZXJpb2QtaW5wdXQnKVxuICAgIHRoaXMuY291bnROYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1jb3VudC1uYW1lJylcbiAgICB0aGlzLm1vbnRoUGVyaW9kID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1wZXJpb2QtbW9udGgnKVxuICAgIHRoaXMueWVhclBlcmlvZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zYWFzLXNob3AtcGVyaW9kLXllYXInKVxuXG4gICAgdGhpcy5jaGVja1RhcmlmZih0YXJpZmZMaXN0KVxuXG4gICAgdGhpcy5pbnB1dD8uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4ge1xuICAgICAgdGhpcy5jaGVja1RhcmlmZih0YXJpZmZMaXN0KVxuICAgIH0pXG4gICAgdGhpcy5wbHVzPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIHRoaXMuY2FsY1BsdXModGhpcy5wbHVzLCBtYXhpbXVtVXNlcnMpXG4gICAgICB0aGlzLmNoZWNrVGFyaWZmKHRhcmlmZkxpc3QpXG4gICAgfSlcbiAgICB0aGlzLm1pbnVzPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgIHRoaXMuY2FsY01pbnVzKHRoaXMubWludXMpXG4gICAgICB0aGlzLmNoZWNrVGFyaWZmKHRhcmlmZkxpc3QpXG4gICAgfSlcblxuICAgIHRoaXMubW9udGhQZXJpb2Q/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7XG4gICAgICB0aGlzLnNldFBlcmlvZChldmVudC50YXJnZXQsIGZhbHNlKVxuICAgIH0pXG5cbiAgICB0aGlzLnllYXJQZXJpb2Q/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGV2ZW50KSA9PiB7XG4gICAgICB0aGlzLnNldFBlcmlvZChldmVudC50YXJnZXQsIHRydWUpXG4gICAgfSlcbiAgICB0aGlzLnBlcmlvZD8ucGFyZW50Tm9kZSEuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICB0aGlzLmNoZWNrVGFyaWZmKHRhcmlmZkxpc3QpXG4gICAgfSlcbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tMaWNlbnNlc0NvdW50ID0gKGVsOiBIVE1MRGl2RWxlbWVudCwgaW5wdXRWYWx1ZTogbnVtYmVyLCB0YXJpZmY6IElQbGFuKSA9PiB7XG4gICAgY29uc3QgYnRuID0gZWwucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1jYXJkLWJ1dHRvbi1jb250YWluZXInKVxuICAgIGlmIChpbnB1dFZhbHVlID4gdGFyaWZmLm1heExpY2Vuc2VDb3VudCAmJiB0YXJpZmYubWluTGljZW5zZUNvdW50ICE9PSB0YXJpZmYubWF4TGljZW5zZUNvdW50KSB7XG4gICAgICBidG4uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpXG4gICAgICByZXR1cm4gYNCU0L4gJHt0YXJpZmYubWF4TGljZW5zZUNvdW50fSAke3RoaXMuY29uZGl0aW9uVXNlclRleHQodGFyaWZmLm1heExpY2Vuc2VDb3VudCl9YFxuICAgIH0gZWxzZSBpZiAoaW5wdXRWYWx1ZSA8IHRhcmlmZi5taW5MaWNlbnNlQ291bnQgJiYgdGFyaWZmLm1heExpY2Vuc2VDb3VudCAhPT0gdGFyaWZmLm1pbkxpY2Vuc2VDb3VudCkge1xuICAgICAgYnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnZGlzYWJsZWQnKVxuICAgICAgcmV0dXJuIGDQntGCICR7dGFyaWZmLm1pbkxpY2Vuc2VDb3VudH0gJHt0aGlzLmNvbmRpdGlvblVzZXJUZXh0KHRhcmlmZi5taW5MaWNlbnNlQ291bnQpfWBcbiAgICB9IGVsc2Uge1xuICAgICAgYnRuLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0QnV0dG9uID0gKGVsOiBIVE1MRGl2RWxlbWVudCwgdGFyaWZmOiBJUGxhbiwgcmVhc29uPzogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgYnV0dG9uID0gZWwucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1jYXJkLWJ1dHRvbi1jb250YWluZXInKVxuICAgIGxldCBwcmljZVRleHQgPSAnJ1xuXG4gICAgY29uc3Qgbm90Q3VycmVudFRhcmlmZiA9IHRoaXMuY29uZmlnPy5zdWJzY3JpcHRpb25JZCAhPT0gdGFyaWZmLmlkXG4gICAgY29uc3Qgbm90UGFja2FnZVRhcmlmZiA9IHRhcmlmZi5tYXhMaWNlbnNlQ291bnQgIT09IHRhcmlmZi5taW5MaWNlbnNlQ291bnRcbiAgICBjb25zdCBwcmljZVdpdGhEaXNjb3VudCA9IHRhcmlmZi5kaXNjb3VudFxuICAgICAgPyB0YXJpZmY/LnByaWNlICogTnVtYmVyKHRoaXMuaW5wdXQ/LnZhbHVlKSAqIDEyICogKCgxMDAgLSB0YXJpZmYuZGlzY291bnQpIC8gMTAwKVxuICAgICAgOiB0YXJpZmY/LnByaWNlICogTnVtYmVyKHRoaXMuaW5wdXQ/LnZhbHVlKSAqIDEyXG5cbiAgICBjb25zdCBwcmljZSA9ICh0aGlzLnBlcmlvZC5jaGVja2VkID8gcHJpY2VXaXRoRGlzY291bnQgOiB0YXJpZmY/LnByaWNlICogTnVtYmVyKHRoaXMuaW5wdXQ/LnZhbHVlKSkudG9Mb2NhbGVTdHJpbmcoKVxuXG4gICAgaWYgKHRhcmlmZj8ucHJpY2UgJiYgbm90Q3VycmVudFRhcmlmZiAmJiAhcmVhc29uICYmIHRoaXMuaW5wdXQgJiYgbm90UGFja2FnZVRhcmlmZikge1xuICAgICAgcHJpY2VUZXh0ID0gYNCa0YPQv9C40YLRjCDQt9CwICR7cHJpY2V9IOKCvWBcbiAgICB9IGVsc2UgaWYgKCFub3RQYWNrYWdlVGFyaWZmICYmIG5vdEN1cnJlbnRUYXJpZmYpIHtcbiAgICAgIHByaWNlVGV4dCA9IGDQktGL0LHRgNCw0YLRjCAke3RhcmlmZi5uYW1lfWBcbiAgICB9IGVsc2UgaWYgKHJlYXNvbikge1xuICAgICAgcHJpY2VUZXh0ID0gcmVhc29uXG4gICAgfSBlbHNlIHtcbiAgICAgIHByaWNlVGV4dCA9ICfQotC10LrRg9GJ0LjQuSDRgtCw0YDQuNGEJ1xuICAgIH1cblxuICAgIGNvbnN0IGhyZWYgPSB0aGlzLmNyZWF0ZUhyZWYodGFyaWZmKVxuXG4gICAgaWYgKCFub3RDdXJyZW50VGFyaWZmKSBidXR0b24uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICdkaXNhYmxlZCcpXG5cbiAgICBidXR0b24uaW5uZXJIVE1MID0gYFxuICAgICAgPGEgY2xhc3M9XCJzYWFzLXNob3AtY2FyZC1idXR0b24taHJlZlwiIGhyZWY9XCIke2hyZWZ9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+XG4gICAgICAgICAgJHtwcmljZVRleHR9XG4gICAgICA8L2E+XG4gICAgICBgXG4gIH1cblxuICBwcml2YXRlIGNoZWNrVGFyaWZmID0gKHRhcmlmZkxpc3Q6IElQbGFuW10pID0+IHtcbiAgICAvL0B0cy1pZ25vcmVcbiAgICB0aGlzLmlucHV0Py52YWx1ZSA9IE51bWJlcih0aGlzLmlucHV0IS52YWx1ZSkgPiA5OTk5OSA/IDk5OTk5IDogTnVtYmVyKHRoaXMuaW5wdXQ/LnZhbHVlKVxuICAgIGlmICh0aGlzLmlucHV0KSB0aGlzLmlucHV0LnN0eWxlLndpZHRoID0gdGhpcy5pbnB1dC52YWx1ZS5sZW5ndGggKiA5ICsgJ3B4J1xuICAgIGlmICh0aGlzLmNvdW50TmFtZSkgdGhpcy5jb3VudE5hbWUudGV4dENvbnRlbnQgPSB0aGlzLnVzZXJUZXh0KE51bWJlcih0aGlzLmlucHV0Py52YWx1ZSkpXG5cbiAgICBmb3IgKGNvbnN0IGVsIG9mIHRoaXMuY2FyZExpc3QpIHtcbiAgICAgIGNvbnN0IHRhcmlmZiA9IHRhcmlmZkxpc3QuZmluZCgoaXRlbSkgPT4gaXRlbS5pZC50b1N0cmluZygpID09PSBlbC5kYXRhc2V0LnRhcmlmZmlkKVxuICAgICAgY29uc3QgcmVhc29uID0gdGhpcy5jaGVja0xpY2Vuc2VzQ291bnQoZWwsIE51bWJlcih0aGlzLmlucHV0Py52YWx1ZSksIHRhcmlmZilcblxuICAgICAgdGhpcy5zZXRCdXR0b24oZWwsIHRhcmlmZiwgcmVhc29uKVxuXG4gICAgICBjb25zdCBwcmljZVRleHQgPSBlbC5xdWVyeVNlbGVjdG9yKCcuc2Fhcy1zaG9wLXByaWNlLXRleHQnKVxuICAgICAgY29uc3QgcHJpY2UgPSBlbC5xdWVyeVNlbGVjdG9yKCcuc2Fhcy1zaG9wLXByaWNlLXZhbHVlJylcbiAgICAgIGNvbnN0IHZhcmlhYmxlT2ZQZXJpb2QgPSB0aGlzLnBlcmlvZC5jaGVja2VkID8gJ9C30LAg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPINCyINCz0L7QtCcgOiAn0LfQsCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8g0LIg0LzQtdGB0Y/RhidcbiAgICAgIGNvbnN0IHllYXJQcmljZVdpdGhEaXNjb3VudCA9XG4gICAgICAgIHRoaXMucGVyaW9kLmNoZWNrZWQgJiYgdGFyaWZmLmRpc2NvdW50XG4gICAgICAgICAgPyAodGFyaWZmLnByaWNlICogMTIgKiAoKDEwMCAtIHRhcmlmZi5kaXNjb3VudCkgLyAxMDApKS50b0xvY2FsZVN0cmluZygpXG4gICAgICAgICAgOiAodGFyaWZmLnByaWNlICogMTIpLnRvTG9jYWxlU3RyaW5nKClcblxuICAgICAgcHJpY2VUZXh0LnRleHRDb250ZW50ID1cbiAgICAgICAgdGFyaWZmLm1heExpY2Vuc2VDb3VudCA9PT0gdGFyaWZmLm1pbkxpY2Vuc2VDb3VudFxuICAgICAgICAgID8gYNC00L4gJHt0YXJpZmYubWF4TGljZW5zZUNvdW50fSDQv9C+0LvRjNC30L7QstCw0YLQtdC70LXQuWBcbiAgICAgICAgICA6IHZhcmlhYmxlT2ZQZXJpb2RcbiAgICAgIHByaWNlLnRleHRDb250ZW50ID0gdGhpcy5wZXJpb2QuY2hlY2tlZCA/IGAke3llYXJQcmljZVdpdGhEaXNjb3VudH0g4oK9YCA6IGAke3RhcmlmZi5wcmljZS50b0xvY2FsZVN0cmluZygpfSDigr1gXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVIcmVmID0gKHRhcmlmZjogSVBsYW4pID0+IHtcbiAgICBjb25zdCBhbm51YWxseSA9IHRoaXMucGVyaW9kLmNoZWNrZWQgPyAnJmFubnVhbGx5PXRydWUnIDogJydcbiAgICBjb25zdCBsaWNlbnNlc0NvdW50ID1cbiAgICAgIHRoaXMuaW5wdXQ/LnZhbHVlICYmIHRhcmlmZi5tYXhMaWNlbnNlQ291bnQgIT09IHRhcmlmZi5taW5MaWNlbnNlQ291bnRcbiAgICAgICAgPyB0aGlzLmlucHV0Py52YWx1ZVxuICAgICAgICA6IHRhcmlmZi5tYXhMaWNlbnNlQ291bnRcblxuICAgIHJldHVybiAoXG4gICAgICB0aGlzLnJlZGlyZWN0VXJsICtcbiAgICAgIGAvIy9jaGVja291dD9wcm9kdWN0SWQ9JHt0aGlzLnByb2R1Y3RJZH0mdGFyaWZmSWQ9JHt0YXJpZmYuaWR9JHthbm51YWxseX0mbGljZW5zZXNDb3VudD0ke2xpY2Vuc2VzQ291bnR9YFxuICAgIClcbiAgfVxuXG4gIHByaXZhdGUgY2FsY1BsdXMgPSAoZWw6IEhUTUxEaXZFbGVtZW50LCBtYXg6IG51bWJlcikgPT4ge1xuICAgIGNvbnN0IGlucHV0OiBIVE1MSW5wdXRFbGVtZW50ID0gZWw/LnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1mb3JtLWlucHV0JylcbiAgICBjb25zdCBjb3VudCA9IHBhcnNlSW50KGlucHV0LnZhbHVlKSArIDFcblxuICAgIGlmIChtYXggPj0gY291bnQpIHtcbiAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgaW5wdXQudmFsdWUgPSBjb3VudFxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2FsY01pbnVzID0gKGVsOiBIVE1MRGl2RWxlbWVudCkgPT4ge1xuICAgIGxldCBpbnB1dDogSFRNTElucHV0RWxlbWVudCA9IGVsPy5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoJy5zYWFzLXNob3AtZm9ybS1pbnB1dCcpXG4gICAgbGV0IGNvdW50ID0gcGFyc2VJbnQoaW5wdXQudmFsdWUpIC0gMVxuXG4gICAgaWYgKDEgPD0gY291bnQpIHtcbiAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgaW5wdXQudmFsdWUgPSBjb3VudFxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2V0UGVyaW9kID0gKGVsOiBhbnksIHY6IGJvb2xlYW4pID0+IHtcbiAgICBjb25zdCBpbnB1dDogSFRNTElucHV0RWxlbWVudCA9IGVsPy5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoJy5zYWFzLXNob3AtcGVyaW9kLWlucHV0JylcbiAgICBpbnB1dC5jaGVja2VkID0gdlxuICB9XG5cbiAgcHJpdmF0ZSB1c2VyVGV4dCA9IChjb3VudDogbnVtYmVyKSA9PiB7XG4gICAgY29uc3QgbGFzdE51bWJlciA9ICtjb3VudC50b1N0cmluZygpLnNsaWNlKC0xKVxuICAgIGNvbnN0IHByZUxhc3ROdW1iZXIgPSArY291bnQudG9TdHJpbmcoKS5zbGljZSgtMiwgLTEpXG4gICAgaWYgKGxhc3ROdW1iZXIgPT09IDEgJiYgcHJlTGFzdE51bWJlciAhPT0gMSkge1xuICAgICAgcmV0dXJuICfQv9C+0LvRjNC30L7QstCw0YLQtdC70YwnXG4gICAgfSBlbHNlIGlmIChsYXN0TnVtYmVyID4gMSAmJiBsYXN0TnVtYmVyIDwgNSAmJiBwcmVMYXN0TnVtYmVyICE9PSAxKSB7XG4gICAgICByZXR1cm4gJ9C/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjydcbiAgICB9IGVsc2UgcmV0dXJuICfQv9C+0LvRjNC30L7QstCw0YLQtdC70LXQuSdcbiAgfVxuXG4gIHByaXZhdGUgY29uZGl0aW9uVXNlclRleHQgPSAoY291bnQ6IG51bWJlcikgPT4ge1xuICAgIHJldHVybiBjb3VudC50b1N0cmluZygpLnNsaWNlKC0xKSA9PT0gJzEnID8gJ9C/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjycgOiAn0L/QvtC70YzQt9C+0LLQsNGC0LXQu9C10LknXG4gIH1cbn1cbiIsImltcG9ydCB7IFdpZGdldFNhYXNTaG9wUHJlc2VudGVyIH0gZnJvbSAnLi9wcmVzZW50ZXIvV2lkZ2V0U2Fhc1Nob3BQcmVzZW50ZXInXG5pbXBvcnQgJy4vc3R5bGUuY3NzJ1xuXG5jb25zdCBwcm9kdWN0SWQgPSAnOTNjNTZhNGMtMzMyNC00NTRkLTlkZmYtMDk0MzM1ZjY2ZjQwJ1xuY29uc3QgYXBpID0gJ2h0dHBzOi8vc2Fhcy1zaG9wLWFwaS5kZXYubXJzYXBwLnJ1J1xuY29uc3QgcmVkaXJlY3RVcmwgPVxuICBsb2NhdGlvbi5ob3N0ID09PSAnc2Fhcy1zaG9wLmNpdHJvbml1bS5jb20nID8gJ2h0dHBzOi8vYWNjb3VudC5zYWFzLXNob3AuY2l0cm9uaXVtLmNvbScgOiAnaHR0cDovL2xvY2FsaG9zdDo0MDAxJ1xuY29uc3QgaWRDb250YWluZXIgPSAnLnNhYXNfc2hvcF90YXJpZmZzJ1xuXG5jb25zdCBjdXJyZW50UHJvZHVjdElkID0gd2luZG93LldpZGdldENvbmZpZz8ucHJvZHVjdElkID8gd2luZG93LldpZGdldENvbmZpZy5wcm9kdWN0SWQgOiBwcm9kdWN0SWRcblxudmFyIE5ld1dpZGdldCA9IG5ldyBXaWRnZXRTYWFzU2hvcFByZXNlbnRlcih7XG4gIGlkQ29udGFpbmVyLFxuICBhcGksXG4gIHJlZGlyZWN0VXJsLFxuICBwcm9kdWN0SWQ6IGN1cnJlbnRQcm9kdWN0SWQsXG59KVxuXG5pZiAod2luZG93LldpZGdldENvbmZpZykge1xuICBOZXdXaWRnZXQuaW5pdCh3aW5kb3cuV2lkZ2V0Q29uZmlnKVxufSBlbHNlIE5ld1dpZGdldC5pbml0KClcbiIsImltcG9ydCB7IElDb25maWcsIElXaWRnZXRTYWFzU2hvUHJlc2VudGVyLCBJV2lkZ2V0U2Fhc1Nob3BQYXJhbXMgfSBmcm9tICcuL0lXaWRnZXRTYWFzU2hvcCdcbmltcG9ydCB7IFdpZGdldEJveCB9IGZyb20gJy4vd2lkZ2V0Qm94L1dpZGdldEJveCdcblxuZXhwb3J0IGNsYXNzIFdpZGdldFNhYXNTaG9wUHJlc2VudGVyIGltcGxlbWVudHMgSVdpZGdldFNhYXNTaG9QcmVzZW50ZXIge1xuICBpZENvbnRhaW5lcjogc3RyaW5nID0gJydcbiAgYXBpOiBzdHJpbmcgPSAnJ1xuICByZWRpcmVjdFVybDogc3RyaW5nID0gJydcbiAgcHJvZHVjdElkOiBzdHJpbmcgfCBudWxsID0gbnVsbFxuXG4gIGNvbnN0cnVjdG9yKHBhcmFtczogSVdpZGdldFNhYXNTaG9wUGFyYW1zKSB7XG4gICAgdGhpcy5pZENvbnRhaW5lciA9IHBhcmFtcy5pZENvbnRhaW5lclxuICAgIHRoaXMuYXBpID0gcGFyYW1zLmFwaVxuICAgIHRoaXMucmVkaXJlY3RVcmwgPSBwYXJhbXMucmVkaXJlY3RVcmxcbiAgICB0aGlzLnByb2R1Y3RJZCA9IHBhcmFtcy5wcm9kdWN0SWRcbiAgfVxuXG4gIGluaXQoY29uZmlnPzogSUNvbmZpZyk6IHZvaWQge1xuICAgIGZldGNoKHRoaXMuYXBpICsgJy9wcm9kdWN0cy8nICsgdGhpcy5wcm9kdWN0SWQgKyAnL3BsYW5zJylcbiAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKHJlc3BvbnNlLnN0YXR1c1RleHQpKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzcG9uc2UpXG4gICAgICB9KVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKClcbiAgICAgIH0pXG4gICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICBpZiAoZG9jdW1lbnQucXVlcnlTZWxlY3Rvcih0aGlzLmlkQ29udGFpbmVyKSkge1xuICAgICAgICAgIGNvbnN0IHdpZGdldEJveCA9IG5ldyBXaWRnZXRCb3goe1xuICAgICAgICAgICAgd2lkZ2V0Qm94OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuaWRDb250YWluZXIpLFxuICAgICAgICAgICAgcmVkaXJlY3RVcmw6IHRoaXMucmVkaXJlY3RVcmwsXG4gICAgICAgICAgICBwcm9kdWN0SWQ6IHRoaXMucHJvZHVjdElkLFxuICAgICAgICAgICAgcGxhbnM6IGRhdGEsXG4gICAgICAgICAgICBjb25maWcsXG4gICAgICAgICAgfSlcbiAgICAgICAgICB3aWRnZXRCb3gud2lkZ2V0Q3JlYXRlKClcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhbGVydCgnQ29udGFpbmVyIHdpdGggaWQgJyArIHRoaXMuaWRDb250YWluZXIgKyAnIG5vdCBmb3VuZCEnKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnJvcilcbiAgICAgIH0pXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJXaWRnZXRCb3giLCJjb25zdHJ1Y3RvciIsInBhcmFtcyIsIndpZGdldEJveCIsInVuZGVmaW5lZCIsInJlZGlyZWN0VXJsIiwicHJvZHVjdElkIiwiY2FyZExpc3QiLCJpbnB1dCIsInBsdXMiLCJtaW51cyIsInBlcmlvZCIsImNvdW50TmFtZSIsIm1vbnRoUGVyaW9kIiwieWVhclBlcmlvZCIsIndpZGdldENyZWF0ZSIsInRoaXMiLCJ0YXJpZmZMaXN0IiwicGxhbnMiLCJkaXNjb3VudCIsIm1heGltdW1Vc2VycyIsImlzQ291bnRDb250YWluZXIiLCJmb3JFYWNoIiwiZWwiLCJtYXhMaWNlbnNlQ291bnQiLCJtaW5MaWNlbnNlQ291bnQiLCJ0ZW1wb3JhcnlXaWRnZXQiLCJ0ZW1wb3JhcnlDYXJkIiwic3R5bGVGb3JCdG4iLCJpZCIsImNvbmZpZyIsImhpZ2h0bGlnaHQiLCJpc0Rpc2FibGVkIiwic3Vic2NyaXB0aW9uSWQiLCJuYW1lIiwicHJpY2UiLCJ0b0xvY2FsZVN0cmluZyIsImRlc2NyaXB0aW9uIiwib3V0cHV0Q2FyZExpc3QiLCJpbm5lckhUTUwiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJxdWVyeVNlbGVjdG9yIiwiY2hlY2tUYXJpZmYiLCJhZGRFdmVudExpc3RlbmVyIiwiY2FsY1BsdXMiLCJjYWxjTWludXMiLCJldmVudCIsInNldFBlcmlvZCIsInRhcmdldCIsInBhcmVudE5vZGUiLCJjaGVja0xpY2Vuc2VzQ291bnQiLCJpbnB1dFZhbHVlIiwidGFyaWZmIiwiYnRuIiwic2V0QXR0cmlidXRlIiwiY29uZGl0aW9uVXNlclRleHQiLCJyZW1vdmVBdHRyaWJ1dGUiLCJzZXRCdXR0b24iLCJyZWFzb24iLCJidXR0b24iLCJwcmljZVRleHQiLCJub3RDdXJyZW50VGFyaWZmIiwibm90UGFja2FnZVRhcmlmZiIsInByaWNlV2l0aERpc2NvdW50IiwiTnVtYmVyIiwidmFsdWUiLCJjaGVja2VkIiwiaHJlZiIsImNyZWF0ZUhyZWYiLCJzdHlsZSIsIndpZHRoIiwibGVuZ3RoIiwidGV4dENvbnRlbnQiLCJ1c2VyVGV4dCIsImZpbmQiLCJpdGVtIiwidG9TdHJpbmciLCJkYXRhc2V0IiwidGFyaWZmaWQiLCJ2YXJpYWJsZU9mUGVyaW9kIiwieWVhclByaWNlV2l0aERpc2NvdW50IiwiYW5udWFsbHkiLCJsaWNlbnNlc0NvdW50IiwibWF4IiwiY291bnQiLCJwYXJzZUludCIsInYiLCJsYXN0TnVtYmVyIiwic2xpY2UiLCJwcmVMYXN0TnVtYmVyIiwibG9jYXRpb24iLCJob3N0IiwiY3VycmVudFByb2R1Y3RJZCIsIndpbmRvdyIsIldpZGdldENvbmZpZyIsIk5ld1dpZGdldCIsImlkQ29udGFpbmVyIiwiYXBpIiwiaW5pdCIsImZldGNoIiwidGhlbiIsInJlc3BvbnNlIiwic3RhdHVzIiwiUHJvbWlzZSIsInJlamVjdCIsIkVycm9yIiwic3RhdHVzVGV4dCIsInJlc29sdmUiLCJqc29uIiwiZGF0YSIsImFsZXJ0IiwiY2F0Y2giLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciXSwic291cmNlUm9vdCI6IiJ9