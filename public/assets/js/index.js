(()=>{"use strict";class t{constructor(t){this.widgetBox=void 0,this.redirectUrl="",this.productId=null,this.cardList=null,this.input=null,this.plus=null,this.minus=null,this.period=null,this.countName=null,this.monthPeriod=null,this.yearPeriod=null,this.widgetCreate=()=>{var t,i,e,s,n,o;const r=this.widgetBox,a=this.plans||[];let c=0,d=1,u=!1;a.forEach((t=>{t.maxLicenseCount>d&&(d=t.maxLicenseCount),t.discount>c&&(c=t.discount),t.maxLicenseCount===t.minLicenseCount||u||(u=!0)}));const l=`\n      <div class="saas-shop-container">\n        <div class="saas-shop-title">Выберите подписку</div>\n        <div class="saas-shop-common-form">\n         ${u?`<div class="saas-shop-count-container">\n            <div class="saas-shop-form-minus"></div>\n            <div class="body2">\n              <input class="saas-shop-form-input" type="number" name="count" min="1"  max="${d}" value="1" \n                      onkeydown="this.style.width = ((this.value.length+1 ) * 9) + 'px';" onkeyup="if(this.value<0) value=1;">\n              <span class="saas-shop-count-name">пользователь</span>\n            </div>\n            <div class="saas-shop-form-plus"></div>\n          </div>`:""}\n          <label class="saas-shop-period-container">\n            <input type="checkbox" class="saas-shop-period-input">\n            <button class="saas-shop-period-month">\n             Месячная\n            </button>\n            <button class="saas-shop-period-year">\n             Годовая\n            </button>  \n            ${c?`<div class="saas-shop-period-sale" > - ${c}% </div>`:""}\n          </label>\n        </div>\n        <div class="saas-shop-card-container"> \n          ${(()=>{let t="";return a.forEach((i=>{var e,s;const n=i.id===(null===(e=this.config)||void 0===e?void 0:e.hightlight)?"contained":"outlined",o=i.id===(null===(s=this.config)||void 0===s?void 0:s.subscriptionId)?"disabled":"";t+=`\n          <div class="saas-shop-card" data-tariffid="${i.id}" >\n            <div class="saas-shop-card-name subtitle2">${i.name}</div>\n            <h5 class="saas-shop-price-value">\n              ${i.price.toLocaleString()} ₽\n               <span> ₽ </span>\n            </h5>\n            <div class="saas-shop-price-text body2">за пользователя в </div>\n            <div class="saas-shop-description body2">${i.description}</div>\n              <button class="saas-shop-card-button-container ${n} large" disabled=${o}></button>\n          </div>    \n          `})),t})()}\n        </div>\n      </div>`;r.innerHTML+=l,this.cardList=document.querySelectorAll(".saas-shop-card"),this.input=document.querySelector(".saas-shop-form-input"),this.plus=document.querySelector(".saas-shop-form-plus"),this.minus=document.querySelector(".saas-shop-form-minus"),this.period=document.querySelector(".saas-shop-period-input"),this.countName=document.querySelector(".saas-shop-count-name"),this.monthPeriod=document.querySelector(".saas-shop-period-month"),this.yearPeriod=document.querySelector(".saas-shop-period-year"),this.checkTariff(a),null===(t=this.input)||void 0===t||t.addEventListener("change",(()=>{this.checkTariff(a)})),null===(i=this.plus)||void 0===i||i.addEventListener("click",(()=>{this.calcPlus(this.plus,d),this.checkTariff(a)})),null===(e=this.minus)||void 0===e||e.addEventListener("click",(()=>{this.calcMinus(this.minus),this.checkTariff(a)})),null===(s=this.monthPeriod)||void 0===s||s.addEventListener("click",(t=>{this.setPeriod(t.target,!1)})),null===(n=this.yearPeriod)||void 0===n||n.addEventListener("click",(t=>{this.setPeriod(t.target,!0)})),null===(o=this.period)||void 0===o||o.parentNode.addEventListener("click",(()=>{this.checkTariff(a)}))},this.checkLicensesCount=(t,i,e)=>{const s=t.querySelector(".saas-shop-card-button-container");return i>e.maxLicenseCount&&e.minLicenseCount!==e.maxLicenseCount?(s.setAttribute("disabled","disabled"),`До ${e.maxLicenseCount} ${this.conditionUserText(e.maxLicenseCount)}`):i<e.minLicenseCount&&e.maxLicenseCount!==e.minLicenseCount?(s.setAttribute("disabled","disabled"),`От ${e.minLicenseCount} ${this.conditionUserText(e.minLicenseCount)}`):void s.removeAttribute("disabled")},this.setButton=(t,i,e)=>{var s,n,o,r;const a=t.querySelector(".saas-shop-card-button-container");let c="";const d=(null===(s=this.config)||void 0===s?void 0:s.subscriptionId)!==i.id,u=i.maxLicenseCount!==i.minLicenseCount,l=i.discount?(null==i?void 0:i.price)*Number(null===(n=this.input)||void 0===n?void 0:n.value)*12*((100-i.discount)/100):(null==i?void 0:i.price)*Number(null===(o=this.input)||void 0===o?void 0:o.value)*12,h=(this.period.checked?l:(null==i?void 0:i.price)*Number(null===(r=this.input)||void 0===r?void 0:r.value)).toLocaleString();c=(null==i?void 0:i.price)&&d&&!e&&this.input&&u?`Купить за ${h} ₽`:!u&&d?`Выбрать ${i.name}`:e||"Текущий тариф";const p=this.createHref(i);d||a.setAttribute("disabled","disabled"),a.innerHTML=`\n      <p class="saas-shop-card-button-href">\n          ${c}\n      </p>\n      `,a.onclick=()=>{window.open(p,"_blank")}},this.checkTariff=t=>{var i,e,s,n;null===(i=this.input)||void 0===i||(i.value=Number(this.input.value)>99999?99999:Number(null===(e=this.input)||void 0===e?void 0:e.value)),this.input&&(this.input.style.width=9*this.input.value.length+"px"),this.countName&&(this.countName.textContent=this.userText(Number(null===(s=this.input)||void 0===s?void 0:s.value)));for(const i of this.cardList){const e=t.find((t=>t.id.toString()===i.dataset.tariffid)),s=this.checkLicensesCount(i,Number(null===(n=this.input)||void 0===n?void 0:n.value),e);this.setButton(i,e,s);const o=i.querySelector(".saas-shop-price-text"),r=i.querySelector(".saas-shop-price-value"),a=this.period.checked?"за пользователя в год":"за пользователя в месяц",c=this.period.checked&&e.discount?(12*e.price*((100-e.discount)/100)).toLocaleString():(12*e.price).toLocaleString();o.textContent=e.maxLicenseCount===e.minLicenseCount?`до ${e.maxLicenseCount} пользователей`:a,r.textContent=this.period.checked?`${c} ₽`:`${e.price.toLocaleString()} ₽`}},this.createHref=t=>{var i,e;const s=this.period.checked?"&annually=true":"",n=(null===(i=this.input)||void 0===i?void 0:i.value)&&t.maxLicenseCount!==t.minLicenseCount?null===(e=this.input)||void 0===e?void 0:e.value:t.maxLicenseCount;return this.redirectUrl+`/checkout?productId=${this.productId}&tariffId=${t.id}${s}&licensesCount=${n}`},this.calcPlus=(t,i)=>{const e=null==t?void 0:t.parentNode.querySelector(".saas-shop-form-input"),s=parseInt(e.value)+1;i>=s&&(e.value=s)},this.calcMinus=t=>{let i=null==t?void 0:t.parentNode.querySelector(".saas-shop-form-input"),e=parseInt(i.value)-1;1<=e&&(i.value=e)},this.setPeriod=(t,i)=>{(null==t?void 0:t.parentNode.querySelector(".saas-shop-period-input")).checked=i},this.userText=t=>{const i=+t.toString().slice(-1),e=+t.toString().slice(-2,-1);return 1===i&&1!==e?"пользователь":i>1&&i<5&&1!==e?"пользователя":"пользователей"},this.conditionUserText=t=>"1"===t.toString().slice(-1)?"пользователя":"пользователей",this.widgetBox=t.widgetBox,this.redirectUrl=t.redirectUrl,this.productId=t.productId,this.plans=t.plans,this.config=t.config}}var i;const e=(null===(i=window.WidgetConfig)||void 0===i?void 0:i.productId)?window.WidgetConfig.productId:"0eb84014-f370-4490-80ae-789473460cee";var s=new class{constructor(t){this.idContainer="",this.api="",this.redirectUrl="",this.productId=null,this.idContainer=t.idContainer,this.api=t.api,this.redirectUrl=t.redirectUrl,this.productId=t.productId}init(i){fetch(this.api+"/products/"+this.productId+"/plans").then((function(t){return 200!==t.status?Promise.reject(new Error(t.statusText)):Promise.resolve(t)})).then((function(t){return t.json()})).then((e=>{document.querySelector(this.idContainer)?new t({widgetBox:document.querySelector(this.idContainer),redirectUrl:this.redirectUrl,productId:this.productId,plans:e.sort(((t,i)=>t.price>i.price?1:-1)),config:i}).widgetCreate():alert("Container with id "+this.idContainer+" not found!")})).catch((t=>{console.log(t)}))}}({idContainer:".saas_shop_tariffs",api:"https://lk.mrsapp.ru/api",redirectUrl:"https://lk.mrsapp.ru",productId:e});window.WidgetConfig?s.init(window.WidgetConfig):s.init()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RixZQUFhVyxLQUFLWCxZQUNsQkMsVUFBV1UsS0FBS1YsVUFDaEJZLE1BQU80RixFQUFLQyxNQUFLLENBQUNDLEVBQVVDLElBQWFELEVBQUU3RSxNQUFROEUsRUFBRTlFLE1BQVEsR0FBSyxJQUNsRUwsV0FFUWYsZUFFVm1HLE1BQU0scUJBQXVCbEcsS0FBS2lGLFlBQWMsY0FDbEQsSUFFRGtCLE9BQU9DLElBQ05DLFFBQVFDLElBQUlGLEVBQU0sR0FFeEIsR0QzQjBDLENBQzFDbkIsWUFYa0IscUJBWWxCQyxJQWRVLDJCQWVWN0YsWUFYa0IsdUJBWWxCQyxVQUFXd0YsSUFHVHZCLE9BQU93QixhQUNUQyxFQUFVRyxLQUFLNUIsT0FBT3dCLGNBQ2pCQyxFQUFVRyxNIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2Fhcy1zaG9wLXNpdGUvLi9zcmMvcHJlc2VudGVyL3dpZGdldEJveC9XaWRnZXRCb3gudHMiLCJ3ZWJwYWNrOi8vc2Fhcy1zaG9wLXNpdGUvLi9zcmMvaW5kZXgudHMiLCJ3ZWJwYWNrOi8vc2Fhcy1zaG9wLXNpdGUvLi9zcmMvcHJlc2VudGVyL1dpZGdldFNhYXNTaG9wUHJlc2VudGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IElDb25maWcgfSBmcm9tICcuLi9JV2lkZ2V0U2Fhc1Nob3AnXG5pbXBvcnQgeyBJUGxhbiwgSVdpZGdldEJveCwgSVdpZGdldEJveFBhcmFtcyB9IGZyb20gJy4vSVdpZGdldEJveCdcblxuZXhwb3J0IGNsYXNzIFdpZGdldEJveCBpbXBsZW1lbnRzIElXaWRnZXRCb3gge1xuICB3aWRnZXRCb3g6IEhUTUxEaXZFbGVtZW50IHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkXG4gIHJlZGlyZWN0VXJsOiBzdHJpbmcgPSAnJ1xuICBwcm9kdWN0SWQ6IHN0cmluZyB8IG51bGwgPSBudWxsXG4gIHBsYW5zOiBJUGxhbltdXG4gIGNvbmZpZzogSUNvbmZpZ1xuXG4gIHByaXZhdGUgY2FyZExpc3Q6IE5vZGVMaXN0T2Y8SFRNTERpdkVsZW1lbnQ+IHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBpbnB1dDogSFRNTElucHV0RWxlbWVudCB8IG51bGwgPSBudWxsXG4gIHByaXZhdGUgcGx1czogSFRNTERpdkVsZW1lbnQgfCBudWxsID0gbnVsbFxuICBwcml2YXRlIG1pbnVzOiBIVE1MRGl2RWxlbWVudCB8IG51bGwgPSBudWxsXG4gIHByaXZhdGUgcGVyaW9kOiBIVE1MSW5wdXRFbGVtZW50IHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSBjb3VudE5hbWU6IEhUTUxTcGFuRWxlbWVudCB8IG51bGwgPSBudWxsXG4gIHByaXZhdGUgbW9udGhQZXJpb2Q6IEhUTUxCdXR0b25FbGVtZW50IHwgbnVsbCA9IG51bGxcbiAgcHJpdmF0ZSB5ZWFyUGVyaW9kOiBIVE1MQnV0dG9uRWxlbWVudCB8IG51bGwgPSBudWxsXG5cbiAgY29uc3RydWN0b3IocGFyYW1zOiBJV2lkZ2V0Qm94UGFyYW1zKSB7XG4gICAgdGhpcy53aWRnZXRCb3ggPSBwYXJhbXMud2lkZ2V0Qm94XG4gICAgdGhpcy5yZWRpcmVjdFVybCA9IHBhcmFtcy5yZWRpcmVjdFVybFxuICAgIHRoaXMucHJvZHVjdElkID0gcGFyYW1zLnByb2R1Y3RJZFxuICAgIHRoaXMucGxhbnMgPSBwYXJhbXMucGxhbnNcbiAgICB0aGlzLmNvbmZpZyA9IHBhcmFtcy5jb25maWdcbiAgfVxuXG4gIHdpZGdldENyZWF0ZSA9ICgpOiB2b2lkID0+IHtcbiAgICBjb25zdCB3aWRnZXRCb3ggPSB0aGlzLndpZGdldEJveFxuICAgIGNvbnN0IHRhcmlmZkxpc3Q6IElQbGFuW10gPSB0aGlzLnBsYW5zIHx8IFtdXG4gICAgbGV0IGRpc2NvdW50OiBudW1iZXIgPSAwXG4gICAgbGV0IG1heGltdW1Vc2VyczogbnVtYmVyID0gMVxuICAgIGxldCBpc0NvdW50Q29udGFpbmVyID0gZmFsc2VcblxuICAgIHRhcmlmZkxpc3QuZm9yRWFjaCgoZWwpID0+IHtcbiAgICAgIGlmIChlbC5tYXhMaWNlbnNlQ291bnQgPiBtYXhpbXVtVXNlcnMpIHtcbiAgICAgICAgbWF4aW11bVVzZXJzID0gZWwubWF4TGljZW5zZUNvdW50XG4gICAgICB9XG5cbiAgICAgIGlmIChlbC5kaXNjb3VudCA+IGRpc2NvdW50KSB7XG4gICAgICAgIGRpc2NvdW50ID0gZWwuZGlzY291bnRcbiAgICAgIH1cblxuICAgICAgaWYgKGVsLm1heExpY2Vuc2VDb3VudCAhPT0gZWwubWluTGljZW5zZUNvdW50ICYmICFpc0NvdW50Q29udGFpbmVyKSB7XG4gICAgICAgIGlzQ291bnRDb250YWluZXIgPSB0cnVlXG4gICAgICB9XG4gICAgfSlcblxuICAgIGNvbnN0IG91dHB1dENhcmRMaXN0ID0gKCkgPT4ge1xuICAgICAgbGV0IHRlbXBvcmFyeUNhcmQgPSBgYFxuICAgICAgdGFyaWZmTGlzdC5mb3JFYWNoKChlbCkgPT4ge1xuICAgICAgICBjb25zdCBzdHlsZUZvckJ0biA9IGVsLmlkID09PSB0aGlzLmNvbmZpZz8uaGlnaHRsaWdodCA/ICdjb250YWluZWQnIDogJ291dGxpbmVkJ1xuICAgICAgICBjb25zdCBpc0Rpc2FibGVkID0gZWwuaWQgPT09IHRoaXMuY29uZmlnPy5zdWJzY3JpcHRpb25JZCA/ICdkaXNhYmxlZCcgOiAnJ1xuXG4gICAgICAgIHRlbXBvcmFyeUNhcmQgKz0gYFxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJzYWFzLXNob3AtY2FyZFwiIGRhdGEtdGFyaWZmaWQ9XCIke2VsLmlkfVwiID5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzYWFzLXNob3AtY2FyZC1uYW1lIHN1YnRpdGxlMlwiPiR7ZWwubmFtZX08L2Rpdj5cbiAgICAgICAgICAgIDxoNSBjbGFzcz1cInNhYXMtc2hvcC1wcmljZS12YWx1ZVwiPlxuICAgICAgICAgICAgICAke2VsLnByaWNlLnRvTG9jYWxlU3RyaW5nKCl9IOKCvVxuICAgICAgICAgICAgICAgPHNwYW4+IOKCvSA8L3NwYW4+XG4gICAgICAgICAgICA8L2g1PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC1wcmljZS10ZXh0IGJvZHkyXCI+0LfQsCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8g0LIgPC9kaXY+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzPVwic2Fhcy1zaG9wLWRlc2NyaXB0aW9uIGJvZHkyXCI+JHtlbC5kZXNjcmlwdGlvbn08L2Rpdj5cbiAgICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz1cInNhYXMtc2hvcC1jYXJkLWJ1dHRvbi1jb250YWluZXIgJHtzdHlsZUZvckJ0bn0gbGFyZ2VcIiBkaXNhYmxlZD0ke2lzRGlzYWJsZWR9PjwvYnV0dG9uPlxuICAgICAgICAgIDwvZGl2PiAgICBcbiAgICAgICAgICBgXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHRlbXBvcmFyeUNhcmRcbiAgICB9XG5cbiAgICBjb25zdCBjb3VudExpY2Vuc2VzID0gaXNDb3VudENvbnRhaW5lclxuICAgICAgPyBgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC1jb3VudC1jb250YWluZXJcIj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzYWFzLXNob3AtZm9ybS1taW51c1wiPjwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImJvZHkyXCI+XG4gICAgICAgICAgICAgIDxpbnB1dCBjbGFzcz1cInNhYXMtc2hvcC1mb3JtLWlucHV0XCIgdHlwZT1cIm51bWJlclwiIG5hbWU9XCJjb3VudFwiIG1pbj1cIjFcIiAgbWF4PVwiJHttYXhpbXVtVXNlcnN9XCIgdmFsdWU9XCIxXCIgXG4gICAgICAgICAgICAgICAgICAgICAgb25rZXlkb3duPVwidGhpcy5zdHlsZS53aWR0aCA9ICgodGhpcy52YWx1ZS5sZW5ndGgrMSApICogOSkgKyAncHgnO1wiIG9ua2V5dXA9XCJpZih0aGlzLnZhbHVlPDApIHZhbHVlPTE7XCI+XG4gICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwic2Fhcy1zaG9wLWNvdW50LW5hbWVcIj7Qv9C+0LvRjNC30L7QstCw0YLQtdC70Yw8L3NwYW4+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzYWFzLXNob3AtZm9ybS1wbHVzXCI+PC9kaXY+XG4gICAgICAgICAgPC9kaXY+YFxuICAgICAgOiAnJ1xuXG4gICAgY29uc3QgdGVtcG9yYXJ5V2lkZ2V0ID0gYFxuICAgICAgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC1jb250YWluZXJcIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC10aXRsZVwiPtCS0YvQsdC10YDQuNGC0LUg0L/QvtC00L/QuNGB0LrRgzwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic2Fhcy1zaG9wLWNvbW1vbi1mb3JtXCI+XG4gICAgICAgICAke2NvdW50TGljZW5zZXN9XG4gICAgICAgICAgPGxhYmVsIGNsYXNzPVwic2Fhcy1zaG9wLXBlcmlvZC1jb250YWluZXJcIj5cbiAgICAgICAgICAgIDxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBjbGFzcz1cInNhYXMtc2hvcC1wZXJpb2QtaW5wdXRcIj5cbiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJzYWFzLXNob3AtcGVyaW9kLW1vbnRoXCI+XG4gICAgICAgICAgICAg0JzQtdGB0Y/Rh9C90LDRj1xuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8YnV0dG9uIGNsYXNzPVwic2Fhcy1zaG9wLXBlcmlvZC15ZWFyXCI+XG4gICAgICAgICAgICAg0JPQvtC00L7QstCw0Y9cbiAgICAgICAgICAgIDwvYnV0dG9uPiAgXG4gICAgICAgICAgICAke2Rpc2NvdW50ID8gYDxkaXYgY2xhc3M9XCJzYWFzLXNob3AtcGVyaW9kLXNhbGVcIiA+IC0gJHtkaXNjb3VudH0lIDwvZGl2PmAgOiAnJ31cbiAgICAgICAgICA8L2xhYmVsPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBjbGFzcz1cInNhYXMtc2hvcC1jYXJkLWNvbnRhaW5lclwiPiBcbiAgICAgICAgICAke291dHB1dENhcmRMaXN0KCl9XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+YFxuXG4gICAgd2lkZ2V0Qm94LmlubmVySFRNTCArPSB0ZW1wb3JhcnlXaWRnZXRcblxuICAgIHRoaXMuY2FyZExpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuc2Fhcy1zaG9wLWNhcmQnKVxuICAgIHRoaXMuaW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2Fhcy1zaG9wLWZvcm0taW5wdXQnKVxuICAgIHRoaXMucGx1cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zYWFzLXNob3AtZm9ybS1wbHVzJylcbiAgICB0aGlzLm1pbnVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1mb3JtLW1pbnVzJylcbiAgICB0aGlzLnBlcmlvZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zYWFzLXNob3AtcGVyaW9kLWlucHV0JylcbiAgICB0aGlzLmNvdW50TmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zYWFzLXNob3AtY291bnQtbmFtZScpXG4gICAgdGhpcy5tb250aFBlcmlvZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zYWFzLXNob3AtcGVyaW9kLW1vbnRoJylcbiAgICB0aGlzLnllYXJQZXJpb2QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2Fhcy1zaG9wLXBlcmlvZC15ZWFyJylcblxuICAgIHRoaXMuY2hlY2tUYXJpZmYodGFyaWZmTGlzdClcblxuICAgIHRoaXMuaW5wdXQ/LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHtcbiAgICAgIHRoaXMuY2hlY2tUYXJpZmYodGFyaWZmTGlzdClcbiAgICB9KVxuICAgIHRoaXMucGx1cz8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICB0aGlzLmNhbGNQbHVzKHRoaXMucGx1cywgbWF4aW11bVVzZXJzKVxuICAgICAgdGhpcy5jaGVja1RhcmlmZih0YXJpZmZMaXN0KVxuICAgIH0pXG4gICAgdGhpcy5taW51cz8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICB0aGlzLmNhbGNNaW51cyh0aGlzLm1pbnVzKVxuICAgICAgdGhpcy5jaGVja1RhcmlmZih0YXJpZmZMaXN0KVxuICAgIH0pXG5cbiAgICB0aGlzLm1vbnRoUGVyaW9kPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4ge1xuICAgICAgdGhpcy5zZXRQZXJpb2QoZXZlbnQudGFyZ2V0LCBmYWxzZSlcbiAgICB9KVxuXG4gICAgdGhpcy55ZWFyUGVyaW9kPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4ge1xuICAgICAgdGhpcy5zZXRQZXJpb2QoZXZlbnQudGFyZ2V0LCB0cnVlKVxuICAgIH0pXG4gICAgdGhpcy5wZXJpb2Q/LnBhcmVudE5vZGUhLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgdGhpcy5jaGVja1RhcmlmZih0YXJpZmZMaXN0KVxuICAgIH0pXG4gIH1cblxuICBwcml2YXRlIGNoZWNrTGljZW5zZXNDb3VudCA9IChlbDogSFRNTERpdkVsZW1lbnQsIGlucHV0VmFsdWU6IG51bWJlciwgdGFyaWZmOiBJUGxhbikgPT4ge1xuICAgIGNvbnN0IGJ0biA9IGVsLnF1ZXJ5U2VsZWN0b3IoJy5zYWFzLXNob3AtY2FyZC1idXR0b24tY29udGFpbmVyJylcbiAgICBpZiAoaW5wdXRWYWx1ZSA+IHRhcmlmZi5tYXhMaWNlbnNlQ291bnQgJiYgdGFyaWZmLm1pbkxpY2Vuc2VDb3VudCAhPT0gdGFyaWZmLm1heExpY2Vuc2VDb3VudCkge1xuICAgICAgYnRuLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnZGlzYWJsZWQnKVxuICAgICAgcmV0dXJuIGDQlNC+ICR7dGFyaWZmLm1heExpY2Vuc2VDb3VudH0gJHt0aGlzLmNvbmRpdGlvblVzZXJUZXh0KHRhcmlmZi5tYXhMaWNlbnNlQ291bnQpfWBcbiAgICB9IGVsc2UgaWYgKGlucHV0VmFsdWUgPCB0YXJpZmYubWluTGljZW5zZUNvdW50ICYmIHRhcmlmZi5tYXhMaWNlbnNlQ291bnQgIT09IHRhcmlmZi5taW5MaWNlbnNlQ291bnQpIHtcbiAgICAgIGJ0bi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgJ2Rpc2FibGVkJylcbiAgICAgIHJldHVybiBg0J7RgiAke3RhcmlmZi5taW5MaWNlbnNlQ291bnR9ICR7dGhpcy5jb25kaXRpb25Vc2VyVGV4dCh0YXJpZmYubWluTGljZW5zZUNvdW50KX1gXG4gICAgfSBlbHNlIHtcbiAgICAgIGJ0bi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJylcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldEJ1dHRvbiA9IChlbDogSFRNTERpdkVsZW1lbnQsIHRhcmlmZjogSVBsYW4sIHJlYXNvbj86IHN0cmluZykgPT4ge1xuICAgIGNvbnN0IGJ1dHRvbiA9IGVsLnF1ZXJ5U2VsZWN0b3IoJy5zYWFzLXNob3AtY2FyZC1idXR0b24tY29udGFpbmVyJylcbiAgICBsZXQgcHJpY2VUZXh0ID0gJydcblxuICAgIGNvbnN0IG5vdEN1cnJlbnRUYXJpZmYgPSB0aGlzLmNvbmZpZz8uc3Vic2NyaXB0aW9uSWQgIT09IHRhcmlmZi5pZFxuICAgIGNvbnN0IG5vdFBhY2thZ2VUYXJpZmYgPSB0YXJpZmYubWF4TGljZW5zZUNvdW50ICE9PSB0YXJpZmYubWluTGljZW5zZUNvdW50XG4gICAgY29uc3QgcHJpY2VXaXRoRGlzY291bnQgPSB0YXJpZmYuZGlzY291bnRcbiAgICAgID8gdGFyaWZmPy5wcmljZSAqIE51bWJlcih0aGlzLmlucHV0Py52YWx1ZSkgKiAxMiAqICgoMTAwIC0gdGFyaWZmLmRpc2NvdW50KSAvIDEwMClcbiAgICAgIDogdGFyaWZmPy5wcmljZSAqIE51bWJlcih0aGlzLmlucHV0Py52YWx1ZSkgKiAxMlxuXG4gICAgY29uc3QgcHJpY2UgPSAodGhpcy5wZXJpb2QuY2hlY2tlZCA/IHByaWNlV2l0aERpc2NvdW50IDogdGFyaWZmPy5wcmljZSAqIE51bWJlcih0aGlzLmlucHV0Py52YWx1ZSkpLnRvTG9jYWxlU3RyaW5nKClcblxuICAgIGlmICh0YXJpZmY/LnByaWNlICYmIG5vdEN1cnJlbnRUYXJpZmYgJiYgIXJlYXNvbiAmJiB0aGlzLmlucHV0ICYmIG5vdFBhY2thZ2VUYXJpZmYpIHtcbiAgICAgIHByaWNlVGV4dCA9IGDQmtGD0L/QuNGC0Ywg0LfQsCAke3ByaWNlfSDigr1gXG4gICAgfSBlbHNlIGlmICghbm90UGFja2FnZVRhcmlmZiAmJiBub3RDdXJyZW50VGFyaWZmKSB7XG4gICAgICBwcmljZVRleHQgPSBg0JLRi9Cx0YDQsNGC0YwgJHt0YXJpZmYubmFtZX1gXG4gICAgfSBlbHNlIGlmIChyZWFzb24pIHtcbiAgICAgIHByaWNlVGV4dCA9IHJlYXNvblxuICAgIH0gZWxzZSB7XG4gICAgICBwcmljZVRleHQgPSAn0KLQtdC60YPRidC40Lkg0YLQsNGA0LjRhCdcbiAgICB9XG5cbiAgICBjb25zdCBocmVmID0gdGhpcy5jcmVhdGVIcmVmKHRhcmlmZilcblxuICAgIGlmICghbm90Q3VycmVudFRhcmlmZikgYnV0dG9uLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnZGlzYWJsZWQnKVxuXG4gICAgYnV0dG9uLmlubmVySFRNTCA9IGBcbiAgICAgIDxwIGNsYXNzPVwic2Fhcy1zaG9wLWNhcmQtYnV0dG9uLWhyZWZcIj5cbiAgICAgICAgICAke3ByaWNlVGV4dH1cbiAgICAgIDwvcD5cbiAgICAgIGBcblxuICAgIC8vQHRzLWlnbm9yZVxuICAgIGJ1dHRvbi5vbmNsaWNrID0gKCkgPT4ge1xuICAgICAgd2luZG93Lm9wZW4oaHJlZiwgJ19ibGFuaycpXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjaGVja1RhcmlmZiA9ICh0YXJpZmZMaXN0OiBJUGxhbltdKSA9PiB7XG4gICAgLy9AdHMtaWdub3JlXG4gICAgdGhpcy5pbnB1dD8udmFsdWUgPSBOdW1iZXIodGhpcy5pbnB1dCEudmFsdWUpID4gOTk5OTkgPyA5OTk5OSA6IE51bWJlcih0aGlzLmlucHV0Py52YWx1ZSlcbiAgICBpZiAodGhpcy5pbnB1dCkgdGhpcy5pbnB1dC5zdHlsZS53aWR0aCA9IHRoaXMuaW5wdXQudmFsdWUubGVuZ3RoICogOSArICdweCdcbiAgICBpZiAodGhpcy5jb3VudE5hbWUpIHRoaXMuY291bnROYW1lLnRleHRDb250ZW50ID0gdGhpcy51c2VyVGV4dChOdW1iZXIodGhpcy5pbnB1dD8udmFsdWUpKVxuXG4gICAgZm9yIChjb25zdCBlbCBvZiB0aGlzLmNhcmRMaXN0KSB7XG4gICAgICBjb25zdCB0YXJpZmYgPSB0YXJpZmZMaXN0LmZpbmQoKGl0ZW0pID0+IGl0ZW0uaWQudG9TdHJpbmcoKSA9PT0gZWwuZGF0YXNldC50YXJpZmZpZClcbiAgICAgIGNvbnN0IHJlYXNvbiA9IHRoaXMuY2hlY2tMaWNlbnNlc0NvdW50KGVsLCBOdW1iZXIodGhpcy5pbnB1dD8udmFsdWUpLCB0YXJpZmYpXG5cbiAgICAgIHRoaXMuc2V0QnV0dG9uKGVsLCB0YXJpZmYsIHJlYXNvbilcblxuICAgICAgY29uc3QgcHJpY2VUZXh0ID0gZWwucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1wcmljZS10ZXh0JylcbiAgICAgIGNvbnN0IHByaWNlID0gZWwucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1wcmljZS12YWx1ZScpXG4gICAgICBjb25zdCB2YXJpYWJsZU9mUGVyaW9kID0gdGhpcy5wZXJpb2QuY2hlY2tlZCA/ICfQt9CwINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjyDQsiDQs9C+0LQnIDogJ9C30LAg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPINCyINC80LXRgdGP0YYnXG4gICAgICBjb25zdCB5ZWFyUHJpY2VXaXRoRGlzY291bnQgPVxuICAgICAgICB0aGlzLnBlcmlvZC5jaGVja2VkICYmIHRhcmlmZi5kaXNjb3VudFxuICAgICAgICAgID8gKHRhcmlmZi5wcmljZSAqIDEyICogKCgxMDAgLSB0YXJpZmYuZGlzY291bnQpIC8gMTAwKSkudG9Mb2NhbGVTdHJpbmcoKVxuICAgICAgICAgIDogKHRhcmlmZi5wcmljZSAqIDEyKS50b0xvY2FsZVN0cmluZygpXG5cbiAgICAgIHByaWNlVGV4dC50ZXh0Q29udGVudCA9XG4gICAgICAgIHRhcmlmZi5tYXhMaWNlbnNlQ291bnQgPT09IHRhcmlmZi5taW5MaWNlbnNlQ291bnRcbiAgICAgICAgICA/IGDQtNC+ICR7dGFyaWZmLm1heExpY2Vuc2VDb3VudH0g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9C10LlgXG4gICAgICAgICAgOiB2YXJpYWJsZU9mUGVyaW9kXG4gICAgICBwcmljZS50ZXh0Q29udGVudCA9IHRoaXMucGVyaW9kLmNoZWNrZWQgPyBgJHt5ZWFyUHJpY2VXaXRoRGlzY291bnR9IOKCvWAgOiBgJHt0YXJpZmYucHJpY2UudG9Mb2NhbGVTdHJpbmcoKX0g4oK9YFxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlSHJlZiA9ICh0YXJpZmY6IElQbGFuKSA9PiB7XG4gICAgY29uc3QgYW5udWFsbHkgPSB0aGlzLnBlcmlvZC5jaGVja2VkID8gJyZhbm51YWxseT10cnVlJyA6ICcnXG4gICAgY29uc3QgbGljZW5zZXNDb3VudCA9XG4gICAgICB0aGlzLmlucHV0Py52YWx1ZSAmJiB0YXJpZmYubWF4TGljZW5zZUNvdW50ICE9PSB0YXJpZmYubWluTGljZW5zZUNvdW50XG4gICAgICAgID8gdGhpcy5pbnB1dD8udmFsdWVcbiAgICAgICAgOiB0YXJpZmYubWF4TGljZW5zZUNvdW50XG5cbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5yZWRpcmVjdFVybCArXG4gICAgICBgL2NoZWNrb3V0P3Byb2R1Y3RJZD0ke3RoaXMucHJvZHVjdElkfSZ0YXJpZmZJZD0ke3RhcmlmZi5pZH0ke2FubnVhbGx5fSZsaWNlbnNlc0NvdW50PSR7bGljZW5zZXNDb3VudH1gXG4gICAgKVxuICB9XG5cbiAgcHJpdmF0ZSBjYWxjUGx1cyA9IChlbDogSFRNTERpdkVsZW1lbnQsIG1heDogbnVtYmVyKSA9PiB7XG4gICAgY29uc3QgaW5wdXQ6IEhUTUxJbnB1dEVsZW1lbnQgPSBlbD8ucGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKCcuc2Fhcy1zaG9wLWZvcm0taW5wdXQnKVxuICAgIGNvbnN0IGNvdW50ID0gcGFyc2VJbnQoaW5wdXQudmFsdWUpICsgMVxuXG4gICAgaWYgKG1heCA+PSBjb3VudCkge1xuICAgICAgLy9AdHMtaWdub3JlXG4gICAgICBpbnB1dC52YWx1ZSA9IGNvdW50XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjYWxjTWludXMgPSAoZWw6IEhUTUxEaXZFbGVtZW50KSA9PiB7XG4gICAgbGV0IGlucHV0OiBIVE1MSW5wdXRFbGVtZW50ID0gZWw/LnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1mb3JtLWlucHV0JylcbiAgICBsZXQgY291bnQgPSBwYXJzZUludChpbnB1dC52YWx1ZSkgLSAxXG5cbiAgICBpZiAoMSA8PSBjb3VudCkge1xuICAgICAgLy9AdHMtaWdub3JlXG4gICAgICBpbnB1dC52YWx1ZSA9IGNvdW50XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRQZXJpb2QgPSAoZWw6IGFueSwgdjogYm9vbGVhbikgPT4ge1xuICAgIGNvbnN0IGlucHV0OiBIVE1MSW5wdXRFbGVtZW50ID0gZWw/LnBhcmVudE5vZGUucXVlcnlTZWxlY3RvcignLnNhYXMtc2hvcC1wZXJpb2QtaW5wdXQnKVxuICAgIGlucHV0LmNoZWNrZWQgPSB2XG4gIH1cblxuICBwcml2YXRlIHVzZXJUZXh0ID0gKGNvdW50OiBudW1iZXIpID0+IHtcbiAgICBjb25zdCBsYXN0TnVtYmVyID0gK2NvdW50LnRvU3RyaW5nKCkuc2xpY2UoLTEpXG4gICAgY29uc3QgcHJlTGFzdE51bWJlciA9ICtjb3VudC50b1N0cmluZygpLnNsaWNlKC0yLCAtMSlcbiAgICBpZiAobGFzdE51bWJlciA9PT0gMSAmJiBwcmVMYXN0TnVtYmVyICE9PSAxKSB7XG4gICAgICByZXR1cm4gJ9C/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjCdcbiAgICB9IGVsc2UgaWYgKGxhc3ROdW1iZXIgPiAxICYmIGxhc3ROdW1iZXIgPCA1ICYmIHByZUxhc3ROdW1iZXIgIT09IDEpIHtcbiAgICAgIHJldHVybiAn0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPJ1xuICAgIH0gZWxzZSByZXR1cm4gJ9C/0L7Qu9GM0LfQvtCy0LDRgtC10LvQtdC5J1xuICB9XG5cbiAgcHJpdmF0ZSBjb25kaXRpb25Vc2VyVGV4dCA9IChjb3VudDogbnVtYmVyKSA9PiB7XG4gICAgcmV0dXJuIGNvdW50LnRvU3RyaW5nKCkuc2xpY2UoLTEpID09PSAnMScgPyAn0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPJyA6ICfQv9C+0LvRjNC30L7QstCw0YLQtdC70LXQuSdcbiAgfVxufVxuIiwiaW1wb3J0IHsgV2lkZ2V0U2Fhc1Nob3BQcmVzZW50ZXIgfSBmcm9tICcuL3ByZXNlbnRlci9XaWRnZXRTYWFzU2hvcFByZXNlbnRlcidcbmltcG9ydCAnLi9zdHlsZS5jc3MnXG5cblxuY29uc3QgcHJvZHVjdElkID0gJzBlYjg0MDE0LWYzNzAtNDQ5MC04MGFlLTc4OTQ3MzQ2MGNlZSdcblxuY29uc3QgYXBpID0gJ2h0dHBzOi8vbGsubXJzYXBwLnJ1L2FwaSdcblxuY29uc3QgaWRDb250YWluZXIgPSAnLnNhYXNfc2hvcF90YXJpZmZzJ1xuXG5jb25zdCByZWRpcmVjdFVybCA9ICdodHRwczovL2xrLm1yc2FwcC5ydSdcblxuLy8gd2luZG93LldpZGdldENvbmZpZyA9IHtcbi8vICAgcHJvZHVjdElkOiAnYWQ1Yjc0YmMtYjlhZi00YTRhLTgxYTktMjFlNzEzY2RjMjA2Jyxcbi8vIH1cblxuY29uc3QgY3VycmVudFByb2R1Y3RJZCA9IHdpbmRvdy5XaWRnZXRDb25maWc/LnByb2R1Y3RJZCA/IHdpbmRvdy5XaWRnZXRDb25maWcucHJvZHVjdElkIDogcHJvZHVjdElkXG5cbnZhciBOZXdXaWRnZXQgPSBuZXcgV2lkZ2V0U2Fhc1Nob3BQcmVzZW50ZXIoe1xuICBpZENvbnRhaW5lcixcbiAgYXBpLFxuICByZWRpcmVjdFVybCxcbiAgcHJvZHVjdElkOiBjdXJyZW50UHJvZHVjdElkLFxufSlcblxuaWYgKHdpbmRvdy5XaWRnZXRDb25maWcpIHtcbiAgTmV3V2lkZ2V0LmluaXQod2luZG93LldpZGdldENvbmZpZylcbn0gZWxzZSBOZXdXaWRnZXQuaW5pdCgpXG4iLCJpbXBvcnQgeyBJQ29uZmlnLCBJV2lkZ2V0U2Fhc1Nob1ByZXNlbnRlciwgSVdpZGdldFNhYXNTaG9wUGFyYW1zIH0gZnJvbSAnLi9JV2lkZ2V0U2Fhc1Nob3AnXG5pbXBvcnQgeyBXaWRnZXRCb3ggfSBmcm9tICcuL3dpZGdldEJveC9XaWRnZXRCb3gnXG5pbXBvcnQgeyBJUGxhbiB9IGZyb20gJy4vd2lkZ2V0Qm94L0lXaWRnZXRCb3gnO1xuXG5leHBvcnQgY2xhc3MgV2lkZ2V0U2Fhc1Nob3BQcmVzZW50ZXIgaW1wbGVtZW50cyBJV2lkZ2V0U2Fhc1Nob1ByZXNlbnRlciB7XG4gIGlkQ29udGFpbmVyOiBzdHJpbmcgPSAnJ1xuICBhcGk6IHN0cmluZyA9ICcnXG4gIHJlZGlyZWN0VXJsOiBzdHJpbmcgPSAnJ1xuICBwcm9kdWN0SWQ6IHN0cmluZyB8IG51bGwgPSBudWxsXG5cbiAgY29uc3RydWN0b3IocGFyYW1zOiBJV2lkZ2V0U2Fhc1Nob3BQYXJhbXMpIHtcbiAgICB0aGlzLmlkQ29udGFpbmVyID0gcGFyYW1zLmlkQ29udGFpbmVyXG4gICAgdGhpcy5hcGkgPSBwYXJhbXMuYXBpXG4gICAgdGhpcy5yZWRpcmVjdFVybCA9IHBhcmFtcy5yZWRpcmVjdFVybFxuICAgIHRoaXMucHJvZHVjdElkID0gcGFyYW1zLnByb2R1Y3RJZFxuICB9XG5cbiAgaW5pdChjb25maWc/OiBJQ29uZmlnKTogdm9pZCB7XG4gICAgZmV0Y2godGhpcy5hcGkgKyAnL3Byb2R1Y3RzLycgKyB0aGlzLnByb2R1Y3RJZCArICcvcGxhbnMnKVxuICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IocmVzcG9uc2Uuc3RhdHVzVGV4dCkpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXNwb25zZSlcbiAgICAgIH0pXG4gICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKVxuICAgICAgfSlcbiAgICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHRoaXMuaWRDb250YWluZXIpKSB7XG4gICAgICAgICAgY29uc3Qgd2lkZ2V0Qm94ID0gbmV3IFdpZGdldEJveCh7XG4gICAgICAgICAgICB3aWRnZXRCb3g6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGhpcy5pZENvbnRhaW5lciksXG4gICAgICAgICAgICByZWRpcmVjdFVybDogdGhpcy5yZWRpcmVjdFVybCxcbiAgICAgICAgICAgIHByb2R1Y3RJZDogdGhpcy5wcm9kdWN0SWQsXG4gICAgICAgICAgICBwbGFuczogZGF0YS5zb3J0KChhOiBJUGxhbiwgYjogSVBsYW4pID0+IGEucHJpY2UgPiBiLnByaWNlID8gMSA6IC0xKSxcbiAgICAgICAgICAgIGNvbmZpZyxcbiAgICAgICAgICB9KVxuICAgICAgICAgIHdpZGdldEJveC53aWRnZXRDcmVhdGUoKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFsZXJ0KCdDb250YWluZXIgd2l0aCBpZCAnICsgdGhpcy5pZENvbnRhaW5lciArICcgbm90IGZvdW5kIScpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycm9yKVxuICAgICAgfSlcbiAgfVxufVxuIl0sIm5hbWVzIjpbIldpZGdldEJveCIsImNvbnN0cnVjdG9yIiwicGFyYW1zIiwid2lkZ2V0Qm94IiwidW5kZWZpbmVkIiwicmVkaXJlY3RVcmwiLCJwcm9kdWN0SWQiLCJjYXJkTGlzdCIsImlucHV0IiwicGx1cyIsIm1pbnVzIiwicGVyaW9kIiwiY291bnROYW1lIiwibW9udGhQZXJpb2QiLCJ5ZWFyUGVyaW9kIiwid2lkZ2V0Q3JlYXRlIiwidGhpcyIsInRhcmlmZkxpc3QiLCJwbGFucyIsImRpc2NvdW50IiwibWF4aW11bVVzZXJzIiwiaXNDb3VudENvbnRhaW5lciIsImZvckVhY2giLCJlbCIsIm1heExpY2Vuc2VDb3VudCIsIm1pbkxpY2Vuc2VDb3VudCIsInRlbXBvcmFyeVdpZGdldCIsInRlbXBvcmFyeUNhcmQiLCJzdHlsZUZvckJ0biIsImlkIiwiY29uZmlnIiwiaGlnaHRsaWdodCIsImlzRGlzYWJsZWQiLCJzdWJzY3JpcHRpb25JZCIsIm5hbWUiLCJwcmljZSIsInRvTG9jYWxlU3RyaW5nIiwiZGVzY3JpcHRpb24iLCJvdXRwdXRDYXJkTGlzdCIsImlubmVySFRNTCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvckFsbCIsInF1ZXJ5U2VsZWN0b3IiLCJjaGVja1RhcmlmZiIsImFkZEV2ZW50TGlzdGVuZXIiLCJjYWxjUGx1cyIsImNhbGNNaW51cyIsImV2ZW50Iiwic2V0UGVyaW9kIiwidGFyZ2V0IiwicGFyZW50Tm9kZSIsImNoZWNrTGljZW5zZXNDb3VudCIsImlucHV0VmFsdWUiLCJ0YXJpZmYiLCJidG4iLCJzZXRBdHRyaWJ1dGUiLCJjb25kaXRpb25Vc2VyVGV4dCIsInJlbW92ZUF0dHJpYnV0ZSIsInNldEJ1dHRvbiIsInJlYXNvbiIsImJ1dHRvbiIsInByaWNlVGV4dCIsIm5vdEN1cnJlbnRUYXJpZmYiLCJub3RQYWNrYWdlVGFyaWZmIiwicHJpY2VXaXRoRGlzY291bnQiLCJOdW1iZXIiLCJ2YWx1ZSIsImNoZWNrZWQiLCJocmVmIiwiY3JlYXRlSHJlZiIsIm9uY2xpY2siLCJ3aW5kb3ciLCJvcGVuIiwic3R5bGUiLCJ3aWR0aCIsImxlbmd0aCIsInRleHRDb250ZW50IiwidXNlclRleHQiLCJmaW5kIiwiaXRlbSIsInRvU3RyaW5nIiwiZGF0YXNldCIsInRhcmlmZmlkIiwidmFyaWFibGVPZlBlcmlvZCIsInllYXJQcmljZVdpdGhEaXNjb3VudCIsImFubnVhbGx5IiwibGljZW5zZXNDb3VudCIsIm1heCIsImNvdW50IiwicGFyc2VJbnQiLCJ2IiwibGFzdE51bWJlciIsInNsaWNlIiwicHJlTGFzdE51bWJlciIsImN1cnJlbnRQcm9kdWN0SWQiLCJXaWRnZXRDb25maWciLCJOZXdXaWRnZXQiLCJpZENvbnRhaW5lciIsImFwaSIsImluaXQiLCJmZXRjaCIsInRoZW4iLCJyZXNwb25zZSIsInN0YXR1cyIsIlByb21pc2UiLCJyZWplY3QiLCJFcnJvciIsInN0YXR1c1RleHQiLCJyZXNvbHZlIiwianNvbiIsImRhdGEiLCJzb3J0IiwiYSIsImIiLCJhbGVydCIsImNhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIl0sInNvdXJjZVJvb3QiOiIifQ==